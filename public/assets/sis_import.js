$(document).ready(function(){function j(a){var c="";if(a.processing_errors&&a.processing_errors.length>0){c+="<li>Errors that prevent importing\n<ul>";for(var e in a.processing_errors){var b=a.processing_errors[e];c+="<li>"+b[0]+" - "+b[1]+"</li>"}c+="</ul>\n</li>"}if(a.processing_warnings&&a.processing_warnings.length>0){c+="<li>Warnings\n<ul>";for(e in a.processing_warnings){b=a.processing_warnings[e];c+="<li>"+b[0]+" - "+b[1]+"</li>"}c+="</ul>\n</li>"}c+="</ul>";return c}function k(a){if(!(a.data&&
a.data.counts))return"";output="<ul><li>Imported Items<ul>";output+="<li>Accounts: "+a.data.counts.accounts+"</li>";output+="<li>Terms: "+a.data.counts.terms+"</li>";output+="<li>Courses: "+a.data.counts.courses+"</li>";output+="<li>Sections: "+a.data.counts.sections+"</li>";output+="<li>Users: "+a.data.counts.users+"</li>";output+="<li>Enrollments: "+a.data.counts.enrollments+"</li>";output+="</ul></li></ul>";return output}function i(){$("#sis_importer").html("Processing<div style='font-size: 0.6eml'>this may take a bit...</div>").attr("disabled",
true);$(".instruction").hide();$(".progress_bar_holder").slideDown();$(".copy_progress").progressbar();f="nothing";var a=0,c=function(){if(f=="nothing"){a++;var b=($(".copy_progress").progressbar("option","value")||0)+0.25;a<10&&$(".copy_progress").progressbar("option","value",b);setTimeout(c,2E3)}else{f="nothing";a=0;setTimeout(c,1E4)}},e=function(){$.ajaxJSON(location.href,"GET",{},function(b){f="updating";b=b.sis_batch;var h=0;if(b){h=Math.max($(".copy_progress").progressbar("option","value")||
0,b.progress);$(".copy_progress").progressbar("option","value",h);$("#import_log").empty();if(b.sis_batch_log_entries)for(var d in b.sis_batch_log_entries){var g=b.sis_batch_log_entries[d].sis_batch_log_entry;h=g.text.split("\\n");if($("#import_log #log_"+g.id).length==0){g=$("<div id='log_"+g.id+"'/>");for(var m in h){var l=$("<div/>");l.text(h[m]);g.append(l)}$("#import_log").append(g)}}}if(!b||b.workflow_state=="imported"){$("#sis_importer").hide();$(".copy_progress").progressbar("option","value",
100);$(".progress_message").html("The import is complete and all records were successfully imported."+k(b))}else if(b.workflow_state=="failed"){code="sis_batch_"+b.id;$(".progress_bar_holder").hide();$("#sis_importer").hide();$(".sis_messages .error_message").html('There was an error importing your SIS data. No records were imported.  Please notify your system administrator and give them the following code: "'+code+'"');$(".sis_messages").show()}else if(b.workflow_state=="failed_with_messages"){$(".progress_bar_holder").hide();
$("#sis_importer").hide();d="No SIS records were imported. The import failed with these messages:";d+=j(b);$(".sis_messages .error_message").html(d);$(".sis_messages").show()}else if(b.workflow_state=="imported_with_messages"){$(".progress_bar_holder").hide();$("#sis_importer").hide();d="The SIS data was imported but with these messages:";d+=j(b);d+=k(b);$(".sis_messages").show().html(d)}else setTimeout(e,1500)},function(){setTimeout(e,3E3)})};setTimeout(e,2E3);setTimeout(c,1E3)}var f="nothing";$("#import_type").change(function(a){a.preventDefault();
new_type=$(this).find(":selected").val();$("#batch_check").hide();$("#import_log_holder").hide()});$("#sis_importer").formSubmit({fileUpload:true,success:function(a){if(a&&a.sis_batch)i();else{$(".sis_messages .error_message").html(a.error_message);$(".sis_messages").show();a.batch_in_progress&&i()}},error:function(a){$(this).find(".submit_button").attr("disabled",false).text("Process Data");$(this).formErrors(a)}});(function(){f="checking";$.ajaxJSON(location.href,"GET",{},function(a){f="nothing";
if((a=a.sis_batch)&&(a.workflow_state=="importing"||a.workflow_state=="created")){f="nothing";i()}})})()});
