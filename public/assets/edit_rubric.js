var limitToOneRubric;
$(document).ready(function(){var b=$("#rubric_dialog"),e=$("#rubric_long_description_dialog");rubricEditing.htmlBody=$("html,body");$("#rubrics").delegate(".long_description_link","click",function(a){a.preventDefault();a=$(this).parents(".rubric").hasClass("editing");var c=$(this).parents(".criterion"),d=c.getTemplateData({textValues:["long_description","description"]});d.long_description=c.find("textarea.long_description").val();e.data("current_criterion",c).fillTemplateData({data:d,htmlValues:["long_description"]}).fillFormData(d).find(".editing").showIf(a&&
!c.hasClass("learning_outcome_criterion")).end().find(".displaying").showIf(!a||c.hasClass("learning_outcome_criterion")).end().dialog("close").dialog({autoOpen:false,title:"Criterion Long Description",width:400}).dialog("open").find("textarea:visible:first").focus().select()}).delegate(".find_rubric_link","click",function(a){a.preventDefault();b.dialog("close").dialog({autoOpen:true,width:800,height:380,resizable:true,title:"Find Existing Rubric"}).dialog("open");if(!b.hasClass("loaded")){b.find(".loading_message").text("Loading rubric groups...");
a=b.find(".grading_rubrics_url").attr("href");$.ajaxJSON(a,"GET",{},function(c){for(var d in c){var f=c[d],g=b.find(".rubrics_dialog_context_select.blank:first").clone(true).removeClass("blank");g.fillTemplateData({data:{name:f.name,context_code:f.context_code,rubrics:f.rubrics+" rubrics"}});b.find(".rubrics_dialog_contexts_select").append(g.show())}c.length==0?b.find(".loading_message").text("No rubrics found"):b.find(".loading_message").remove();b.find(".rubrics_dialog_rubrics_holder").slideDown();
b.find(".rubrics_dialog_contexts_select .rubrics_dialog_context_select:visible:first").click();b.addClass("loaded")},function(){b.find(".loading_message").text("Loading rubrics failed, please try again")})}}).delegate(".edit_rubric_link","click",function(){var a=$(this);if(!a.hasClass("copy_edit")||confirm("You can't edit this rubric, either because you don't have permission or it's being used in more than one place. Any changes you make will result in a new rubric based on the old rubric.  Continue anyway?"))rubricEditing.editRubric(a.parents(".rubric"),
a.attr("href"));return false});$(".rubric .delete_rubric_link").bind("click",function(a,c){a.preventDefault();var d="Are you sure you want to delete this rubric?";if(c&&c.confirmationMessage)d=c.confirmationMessage;$(this).parents(".rubric").confirmDelete({url:$(this).attr("href"),message:d,success:function(){$(this).fadeOut(function(){$(".add_rubric_link").slideDown();c&&$.isFunction(c)&&c()})}})});e.find(".save_button").click(function(){var a=e.find("textarea.long_description").val(),c=e.data("current_criterion");
if(c){c.fillTemplateData({data:{long_description:a}});c.find("textarea.long_description").val(a);c.find(".long_description_holder").toggleClass("empty",!a)}e.dialog("close")});e.find(".cancel_button").click(function(){e.dialog("close")});$(".add_rubric_link").click(function(a){a.preventDefault();if(!($("#rubric_new").length>0))if(!(limitToOneRubric&&$("#rubrics .rubric:visible").length>0)){a=rubricEditing.addRubric();$("#rubrics").append(a.show());a.find(":text:first").focus().select();limitToOneRubric&&
$(".add_rubric_link").hide()}});$("#rubric_dialog").delegate(".rubrics_dialog_context_select","click",function(a){a.preventDefault();$(".rubrics_dialog_contexts_select .selected_side_tab").removeClass("selected_side_tab");var c=$(this);c.addClass("selected_side_tab");var d=c.getTemplateData({textValues:["context_code"]}).context_code;if(c.hasClass("loaded")){b.find(".rubrics_loading_message").hide();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();
b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+d).show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()}else{b.find(".rubrics_loading_message").text("Loading rubrics...").show();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").hide();a=b.find(".grading_rubrics_url").attr("href")+"?context_code="+d;$.ajaxJSON(a,"GET",{},function(f){c.addClass("loaded");b.find(".rubrics_loading_message").hide();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();
for(var g in f){var h=f[g].rubric_association,i=h.rubric,j=b.find(".rubrics_dialog_rubric_select.blank:first").clone(true);j.addClass(h.context_code);i.criterion_count=i.data.length;j.fillTemplateData({data:i}).removeClass("blank");b.find(".rubrics_dialog_rubrics_select").append(j.show());h=b.find(".rubrics_dialog_rubric.blank:first").clone(true);h.removeClass("blank");h.find(".criterion.blank").hide();i.rubric_total=i.points_possible;h.fillTemplateData({data:i,id:"rubric_dialog_"+i.id});for(g in i.data){var k=
i.data[g];k.criterion_points=k.points;k.criterion_points_possible=k.points;k.criterion_description=k.description;j=k.ratings;delete k.ratings;var l=h.find(".criterion.blank:first").clone().removeClass("blank");l.fillTemplateData({data:k});l.find(".rating_holder").addClass("blank");for(var o in j){k=j[o];var m=l.find(".rating_holder.blank:first").clone().removeClass("blank");k.rating=k.description;m.fillTemplateData({data:k});l.find(".ratings").append(m.show())}l.find(".rating_holder.blank").remove();
h.find(".rubric.rubric_summary tr.summary").before(l.show())}b.find(".rubrics_dialog_rubrics").append(h)}b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+d).show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()},function(){b.find(".rubrics_loading_message").text("Loading rubrics failed, please try again")})}}).delegate(".rubrics_dialog_rubric_select","click",
function(a){a.preventDefault();a=$(this);a.find("a").focus();var c=a.getTemplateData({textValues:["id"]}).id;$(".rubric_dialog .rubrics_dialog_rubric_select").removeClass("selected_side_tab");a.addClass("selected_side_tab");$(".rubric_dialog .rubrics_dialog_rubric").hide();$(".rubric_dialog #rubric_dialog_"+c).show()}).delegate(".select_rubric_link","click",function(a){a.preventDefault();a={};var c=b.getTemplateData({textValues:["rubric_association_type","rubric_association_id","rubric_association_purpose"]});
a["rubric_association[association_type]"]=c.rubric_association_type;a["rubric_association[association_id]"]=c.rubric_association_id;a["rubric_association[rubric_id]"]=$(this).parents(".rubrics_dialog_rubric").getTemplateData({textValues:["id"]}).id;a["rubric_association[purpose]"]=c.rubric_association_purpose;b.loadingImage();c=b.find(".select_rubric_url").attr("href");$.ajaxJSON(c,"POST",a,function(d){b.loadingImage("remove");var f=$("#rubrics .rubric:visible:first");if(f.length===0)f=rubricEditing.addRubric();
var g=d.rubric;g.rubric_association_id=d.rubric_association.id;g.permissions=g.permissions||{};if(d.rubric_association.permissions){g.permissions.update_association=d.rubric_association.permissions.update;g.permissions.delete_association=d.rubric_association.permissions["delete"]}rubricEditing.updateRubric(f,g);rubricEditing.hideEditRubric(f,false);b.dialog("close")},function(){b.loadingImage("remove")})});b.find(".cancel_find_rubric_link").click(function(a){a.preventDefault();b.dialog("close")});
b.find(".rubric_brief").find(".expand_data_link,.collapse_data_link").click(function(a){a.preventDefault();$(this).parents(".rubric_brief").find(".expand_data_link,.collapse_data_link").toggle().end().find(".details").slideToggle()});$("#edit_rubric_form").formSubmit({processData:function(a){a=$(this).parents(".rubric");if(a.find(".criterion:not(.blank)").length===0)return false;a=rubricEditing.rubricData(a);if(a["rubric_association[use_for_grading]"]=="1"){var c=parseFloat($("#full_assignment .points_possible").text()),
d=parseFloat(a.points_possible);if(c&&d!=c)if(!confirm("The points total does not match the assignment's points.  Do you want to change the assignment's points to match the rubric score?"))return false}return a},beforeSubmit:function(a){var c=$(this).parents(".rubric");c.find("thead .title").text(a["rubric[title]"]);c.find(".rubric_total").text(a.points_possible);c.removeClass("editing");c.attr("id")=="rubric_new"?c.attr("id","rubric_adding"):c.prev(".rubric").remove();$(this).parents("tr").hide();
c.loadingImage();return c},success:function(a,c){var d=a.rubric;c.loadingImage("remove");d.rubric_association_id=a.rubric_association.id;d.permissions=d.permissions||{};if(a.rubric_association.permissions){d.permissions.update_association=a.rubric_association.permissions.update;d.permissions.delete_association=a.rubric_association.permissions["delete"]}rubricEditing.updateRubric(c,d);if(a.rubric_association&&a.rubric_association.use_for_grading){$("#full_assignment .points_possible").text(d.points_possible);
$("#full_assignment input.points_possible").val(d.points_possible)}c.find(".rubric_title .links:not(.locked)").show()}});$("#edit_rubric_form .cancel_button").click(function(){rubricEditing.hideEditRubric($(this).parents(".rubric"),true)});$("#find_outcome_criterion_dialog .outcomes_select").click(function(a){a.preventDefault();$("#find_outcome_criterion_dialog .outcomes_select.selected_side_tab").removeClass("selected_side_tab");$(this).addClass("selected_side_tab");a=$(this).getTemplateData({textValues:["id"]}).id;
$("#find_outcome_criterion_dialog .outcomes_list .outcome").hide();$("#find_outcome_criterion_dialog .outcomes_list .outcome_"+a).show()});$("#find_outcome_criterion_dialog .select_outcome_link").click(function(a){a.preventDefault();var c=$(this).parents(".outcome");if($("#find_outcome_criterion_dialog").data("current_rubric")){a=$("#find_outcome_criterion_dialog").data("current_rubric");var d=c.find(".learning_outcome_id").text();a.find(".criterion.learning_outcome_"+d).find(".delete_criterion_link").click();
$("#find_outcome_criterion_dialog").dialog("close");a.find(".add_criterion_link").click();a=a.find(".criterion:not(.blank):last");a.toggleClass("ignore_criterion_for_scoring",!c.find(".criterion_for_scoring").attr("checked"));a.find(".mastery_points").val(c.find(".mastery_points").text());a.addClass("learning_outcome_criterion");a.find(".learning_outcome_id").text(d);a.find(".criterion_points").val(c.find(".rating:not(.blank):first .points").text()).blur();for(d=0;d<c.find(".rating:not(.blank)").length-
2;d++)a.find(".rating:not(.blank):first").addClass("add_column").click();a.find(".rating:not(.blank)").each(function(g){g=c.find(".rating:not(.blank)").eq(g).getTemplateData({textValues:["description","points"]});$(this).fillTemplateData({data:g})});d=c.find(".body.description").html();var f=c.find(".mastery_points").text();a.find(".cancel_button").click();a.find(".long_description").val(d);a.find(".long_description_holder").toggleClass("empty",!d);a.find(".criterion_description_value").text(c.find(".short_description").text());
a.find(".criterion_description").val(c.find(".short_description").text()).focus().select();a.find(".mastery_points").text(f)}});$("#rubrics").delegate(".add_criterion_link","click",function(){var a=rubricEditing.addCriterion($(this).parents(".rubric"));rubricEditing.editCriterion(a);return false}).delegate(".find_outcome_link","click",function(){rubricEditing.findOutcomeCriterion($(this).parents(".rubric"));return false}).delegate(".criterion_description_value","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));
return false}).delegate(".edit_criterion_link","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));return false}).delegate(".delete_criterion_link","click",function(){var a=$(this).parents(".criterion");a.fadeOut(function(){var c=a.parents(".rubric");a.remove();rubricEditing.updateCriteria(c);rubricEditing.updateRubricPoints(c)});return false}).delegate(".rating_description_value,.edit_rating_link","click",function(){rubricEditing.editRating($(this).parents(".rating"));return false}).bind("mouseover",
function(a){$target=$(a.target);$target.closest(".ratings").length||rubricEditing.hideCriterionAdd($target.parents(".rubric"))}).delegate(".rating","mousemove",function(a){var c=$(this),d=c.parents(".rubric");if(d.find(".rating.editing").length>0||c.parents(".criterion").hasClass("learning_outcome_criterion")){rubricEditing.hideCriterionAdd(d);return false}if(!$.data(this,"hover_offset")){$.data(this,"hover_offset",c.offset());$.data(this,"hover_width",c.outerWidth());var f=$.data(this,"points",parseFloat(c.find(".points").text())),
g=$.data(this,"prev_points",parseFloat(c.prev(".rating").find(".points").text())),h=$.data(this,"next_points",parseFloat(c.next(".rating").find(".points").text()));$.data(this,"prev_diff",Math.abs(f-g));$.data(this,"next_diff",Math.abs(f-h))}f=$.data(this,"hover_offset");g=$.data(this,"hover_width");h=c.parents(".ratings");a=a.pageX;var i=false;if(a<=f.left+g/2)i=true;var j=h.data("hover_rating");h=h.data("hover_left_side");if(!j||c[0]!=j[0]||i!=h){rubricEditing.hideCriterionAdd(d);var k,l;if(i&&
(k=c.prev(".rating"))&&k.length){c.addClass("add_left");k.addClass("add_right");c[a<=f.left+10?"addClass":"removeClass"]("add_column")}else if(!i&&(l=c.next(".rating"))&&l.length){c.addClass("add_right");l.addClass("add_left");c[a>=f.left+g-10?"addClass":"removeClass"]("add_column")}}else if(j)if(i)a<=f.left+10&&$.data(this,"prev_diff")>1?c.addClass("add_column"):c.removeClass("add_column");else a>=f.left+g-10&&$.data(this,"next_diff")>1?c.addClass("add_column"):c.removeClass("add_column");return false}).delegate(".rating",
"mouseout",function(){$(this).data("hover_offset",null).data("hover_width",null)}).delegate(".delete_rating_link","click",function(a){a.preventDefault();rubricEditing.hideCriterionAdd($(this).parents(".rubric"));$(this).parents(".rating").fadeOut(function(){var c=$(this).parents(".criterion");$(this).remove();rubricEditing.sizeRatings(c)})}).delegate(".add_column","click",function(){var a=$(this),c=a.parents(".rubric");if(c.hasClass("editing")){var d=a.clone(true).removeClass("edge_rating"),f=parseFloat(a.find(".points").text()),
g=a.parents(".criterion"),h=g.find(".criterion_points"),i=parseFloat(h.val(),10)||5,j={description:"Rating Description"},k=a.hasClass("add_left");if(a.hasClass("add_left")){h=parseFloat(a.prev(".rating").find(".points").text());j.points=Math.round((f+h)/2);if(j.points==f||j.points==h){j.points=h;g.find(".criterion_points").val(i+1)}}else{var l=parseFloat(a.next(".rating").find(".points").text());j.points=Math.round((f+l)/2);if(j.points==f||j.points==l){j.points=f;h.val(i+1)}}d.fillTemplateData({data:j});
k?a.before(d):a.after(d);rubricEditing.hideCriterionAdd(c);rubricEditing.updateCriterionPoints(g);rubricEditing.sizeRatings(g)}return false});$(".criterion_points").keydown(function(a){if(a.keyCode==13){rubricEditing.updateCriterionPoints($(this).parents(".criterion"));$(this).blur()}}).blur(function(){rubricEditing.updateCriterionPoints($(this).parents(".criterion"))});$("#edit_criterion").delegate(".cancel_button","click",function(){rubricEditing.hideEditCriterion()});$("#edit_criterion_form").submit(function(a){a.preventDefault();
a.stopPropagation();a=$(this).parents("#edit_criterion").getFormData();a.criterion_description_value=a.description;delete a.description;$(this).parents(".criterion").fillTemplateData({data:a});rubricEditing.hideEditCriterion()});$("#edit_rating").delegate(".cancel_button","click",function(){rubricEditing.hideEditRating()});$("#edit_rating_form").submit(function(a){a.preventDefault();a.stopPropagation();a=$(this).parents("#edit_rating").getFormData();a.points=parseFloat(a.points);if(isNaN(a.points)){a.points=
parseFloat($(this).parents(".criterion").find(".criterion_points").val());if(isNaN(a.points))a.points=5}var c=$(this).parents(".rating");c.fillTemplateData({data:a});c.prev(".rating").length===0&&$(this).parents(".criterion").find(".criterion_points").val(a.points);rubricEditing.updateCriterionPoints($(this).parents(".criterion"),true)});$("#edit_rubric_form .rubric_custom_rating").change(function(){$(this).parents(".rubric").find("tr.criterion").find(".ratings").showIf(!$(this).attr("checked")).end().find(".custom_ratings").showIf($(this).attr("checked"))}).triggerHandler("change");
$("#edit_rubric_form #totalling_rubric").change(function(){$(this).parents(".rubric").find(".total_points_holder").showIf(!$(this).attr("checked"))});$("#edit_rubric_form .grading_rubric_checkbox").change(function(){$(this).parents(".rubric").find(".totalling_rubric").css("visibility",$(this).attr("checked")?"hidden":"visible");$(this).parents(".rubric").find(".totalling_rubric_checkbox").attr("checked",false)}).triggerHandler("change");$("#criterion_blank").find(".criterion_points").val("5");$("#default_rubric").find(".criterion").length<=
1&&rubricEditing.addCriterion($("#default_rubric"));setInterval(rubricEditing.sizeRatings,1E4)});
var rubricEditing={htmlBody:null,updateCriteria:function(b){b.find(".criterion:not(.blank)").each(function(e){$(this).attr("id","criterion_"+(e+1))})},addCriterion:function(b){var e=b.find(".criterion.blank:first").clone(true);e.removeClass("blank");b.find(".summary").before(e.show());rubricEditing.updateCriteria(b);rubricEditing.updateRubricPoints(b);rubricEditing.sizeRatings(e);return e},findOutcomeCriterion:function(b){var e=$("#find_outcome_criterion_dialog");e.data("current_rubric",b);if(!e.hasClass("loaded")){e.find(".loading_message").text("Loading Outcomes...");
$.ajaxJSON(e.find(".outcomes_list_url").attr("href"),"GET",{},function(a){valids=[];for(var c in a){var d=a[c].learning_outcome;d.data&&d.data.rubric_criterion&&valids.push(d)}if(valids.length===0)e.find(".loading_message").text("No Rubric-Configured Outcomes found");else{e.find(".loading_message").hide();e.addClass("loaded");for(c in valids){d=valids[c];d.name=d.short_description;d.mastery_points=d.data.rubric_criterion.mastery_points||d.data.rubric_criterion.points_possible;a=e.find(".outcomes_select.blank:first").clone(true).removeClass("blank");
d.title=d.short_description;var f=$("<div/>");f.html(d.short_description);d.title=$.truncateText($.trim(f.text()),35);d.display_name=d.cached_context_short_name||"";a.fillTemplateData({data:d});e.find(".outcomes_selects").append(a.show());a=e.find(".outcome.blank:first").clone(true).removeClass("blank");d.learning_outcome_id=d.id;a.fillTemplateData({data:d,htmlValues:["description"]});a.addClass("outcome_"+d.id);if(d.data&&d.data.rubric_criterion)for(var g in d.data.rubric_criterion.ratings){f=d.data.rubric_criterion.ratings[g];
var h=a.find(".rating.blank").clone(true).removeClass("blank");h.fillTemplateData({data:f});a.find("tr").append(h.show())}e.find(".outcomes_list").append(a)}e.find(".outcomes_select:not(.blank):first").click()}},function(){e.find(".loading_message").text("Outcomes Retrieval failed unexpected.  Please try again.")})}e.dialog("close").dialog({autoOpen:false,modal:true,title:"Find Outcome Criterion",width:700,height:400}).dialog("open")},hideCriterionAdd:function(b){b.find(".add_right, .add_left, .add_column").removeClass("add_left add_right add_column")},
updateRubricPoints:function(b){var e=0;b.find(".criterion:not(.blank):not(.ignore_criterion_for_scoring) .criterion_points").each(function(){var a=parseFloat($(this).val(),10);isNaN(a)||(e+=a)});b.find(".rubric_total").text(e)},updateCriterionPoints:function(b,e){rubricEditing.hideEditRating();var a=$.makeArray(b.find(".rating")).reverse(),c=-1,d=parseFloat(b.find(".criterion_points").val());if(isNaN(d))d=5;b.find(".rating:first .points").text(d);$.each(a,function(l,o){var m=$(o),n=m.getTemplateData({textValues:["points"]});
if(n.points<c){n.points=c+1;m.fillTemplateData({data:n})}c=parseFloat(n.points)});if(e&&c>d)d=c;b.find(".criterion_points").val(d);b.find(".display_criterion_points").text(d);if(!b.data("criterion_points")||b.data("criterion_points")!=d){if(!b.data("criterion_points")){a=parseFloat(b.find(".rating:first .points").text());b.data("criterion_points",a)}var f=parseFloat(b.data("criterion_points")),g=d,h=b.find(".rating");$(h[0]).find(".points").text(d);for(var i=d,j=1;j<h.length-1;j++){a=parseFloat($(h[j]).find(".points").text());
var k=Math.round(a/f*g);if(isNaN(a)||a==0&&i>0)k=i-Math.round(i/(h.length-j));if(k>=i)k=i-1;i=k=Math.max(0,k);$(h[j]).find(".points").text(k)}b.data("criterion_points",d)}rubricEditing.updateRubricPoints(b.parents(".rubric"))},editRating:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditRating(true);rubricEditing.hideCriterionAdd(b.parents(".rubric"));b.find(".rating").height();var e=b.getTemplateData({textValues:["description","points"]}),a=$("#edit_rating");a.fillFormData(e);
b.find(".container").hide();b.append(a.show());a.find(":input:first").focus().select();b.addClass("editing");rubricEditing.sizeRatings(b.parents(".criterion"))}},hideEditRating:function(b){var e=$("#edit_rating");e.filter(":visible").length>0&&b&&e.find("form").submit();b=e.parents(".rating");b.removeClass("editing");e.appendTo($("body")).hide();b.find(".container").show();rubricEditing.sizeRatings(b.parents(".criterion"));rubricEditing.hideCriterionAdd(b.parents(".rubric"))},editCriterion:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditCriterion(true);
var e=b.find(".criterion_description");e.find(".description").height();var a=e.getTemplateData({textValues:["description"]}),c=$("#edit_criterion");c.fillFormData(a);e.find(".container").hide().after(c.show());c.find(":input:first").focus().select();rubricEditing.sizeRatings(b)}},hideEditCriterion:function(b){var e=$("#edit_criterion");e.filter(":visible").length>0&&b&&e.find("form").submit();b=e.parents(".criterion");e.appendTo("body").hide();b.find(".criterion_description").find(".container").show();
rubricEditing.sizeRatings(b)},originalSizeRatings:function(){var b=$(".rubric:not(.rubric_summary) .criterion:visible");if(b.length){var e=$.windowScrollTop();b.each(function(){var a=$(this),c=a.find(".ratings:visible");if(c.length){var d=c.find(".rating .container").css("height","");a=Math.max(c.height(),a.find(".criterion_description .container").height());d.css("height",a-10+"px")}});rubricEditing.htmlBody.scrollTop(e)}},rubricData:function(b){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));
b.find(".criterion_points").each(function(){var d=$(this).val();$(this).parents(".criterion").find(".display_criterion_points").text(d)});var e=b.getFormData();b.find("thead .title").text(e.title);e=b.getTemplateData({textValues:["title","description","rubric_total","rubric_association_id"]});var a={};a["rubric[title]"]=e.title;a["rubric[points_possible]"]=e.rubric_total;a["rubric_association[use_for_grading]"]=b.find(".grading_rubric_checkbox").attr("checked")?"1":"0";a["rubric_association[hide_score_total]"]=
"0";if(a["rubric_association[use_for_grading]"]=="0")a["rubric_association[hide_score_total]"]=b.find(".totalling_rubric_checkbox").attr("checked")?"1":"0";a["rubric[free_form_criterion_comments]"]=b.find(".rubric_custom_rating").attr("checked")?"1":"0";a["rubric_association[id]"]=e.rubric_association_id;var c=0;b.find(".criterion:not(.blank)").each(function(){var d=$(this);d.hasClass("learning_outcome_criterion")||d.find("span.mastery_points").text(parseFloat(d.find("input.mastery_points").val(),
10)||"0");var f=d.getTemplateData({textValues:["description","display_criterion_points","learning_outcome_id","mastery_points","long_description","criterion_id"]});f.long_description=d.find("textarea.long_description").val();f.mastery_points=d.find("span.mastery_points").text();var g="rubric[criteria]["+c+"]";a[g+"[description]"]=f.description;a[g+"[points]"]=f.display_criterion_points;a[g+"[learning_outcome_id]"]=f.learning_outcome_id;a[g+"[long_description]"]=f.long_description;a[g+"[id]"]=f.criterion_id;
if(f.learning_outcome_id)a[g+"[mastery_points]"]=f.mastery_points;var h=0;d.find(".rating").each(function(){var i=$(this).getTemplateData({textValues:["description","points","rating_id"]}),j=g+"[ratings]["+h+"]";a[j+"[description]"]=i.description;a[j+"[points]"]=i.points;a[j+"[id]"]=i.rating_id;h++});c++});a.title=a["rubric[title]"];a.points_possible=a["rubric[points_possible]"];a.rubric_id=b.attr("id").substring(7);return a=$.extend(a,$("#rubrics #rubric_parameters").getFormData())},addRubric:function(){var b=
$("#default_rubric").clone(true).attr("id","rubric_new").addClass("editing");b.find("#edit_rubric").remove();var e=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),a=e.find("#edit_rubric_form");b.append(e);a.attr("method","POST").attr("action",$("#add_rubric_url").attr("href"));e=parseFloat($("#full_assignment .points_possible").text());a.find(".rubric_grading").showIf(e||$("#full_assignment").length>0);return b},editRubric:function(b,e){var a=b.clone(true).addClass("editing");
a.find("#edit_rubric").remove();var c=a.getTemplateData({textValues:["use_for_grading","free_form_criterion_comments","hide_score_total"]});b.hide().after(a.show());var d=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),f=d.find("#edit_rubric_form");a.append(d);a.find(":text:first").focus().select();f.find(".grading_rubric_checkbox").attr("checked",c.use_for_grading=="true").triggerHandler("change");f.find(".rubric_custom_rating").attr("checked",c.free_form_criterion_comments==
"true").triggerHandler("change");f.find(".totalling_rubric_checkbox").attr("checked",c.hide_score_total=="true").triggerHandler("change");f.find(".save_button").text(a.attr("id")=="rubric_new"?"Create Rubric":"Update Rubric");f.attr("method","PUT").attr("action",e);rubricEditing.sizeRatings();return a},hideEditRubric:function(b,e){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));b.removeClass("editing");$("#edit_criterion").hide().appendTo("body");b.find(".edit_rubric").remove();
if(e){b.attr("id")!="rubric_new"?b.prev(".rubric").show():$(".add_rubric_link").slideDown();b.remove()}else b.find(".rubric_title .links").show()},updateRubric:function(b,e){b.find(".criterion:not(.blank)").remove();var a=b.find(".rating:first").clone(true).removeAttr("id");b.fillTemplateData({data:e,id:"rubric_"+e.id,hrefValues:["id","rubric_association_id"],avoid:".criterion"});b.fillFormData(e);var c=$.replaceTags(b.find(".edit_rubric_url").attr("href"),"rubric_id",e.id);b.find(".edit_rubric_link").attr("href",
c);c=$.replaceTags(b.find(".delete_rubric_url").attr("href"),"association_id",e.rubric_association_id);b.find(".delete_rubric_link").attr("href",c);b.find(".edit_rubric_link").showIf(e.permissions.update_association);b.find(".find_rubric_link").showIf(e.permissions.update_association&&!$("#rubrics").hasClass("raw_listing"));b.find(".delete_rubric_link").showIf(e.permissions.delete_association);b.find(".criterion:not(.blank) .ratings").empty();for(var d in e.criteria){c=e.criteria[d];c.display_criterion_points=
c.points;c.criterion_id=c.id;var f=b.find(".criterion.blank:first").clone(true).show().removeAttr("id");f.removeClass("blank");f.fillTemplateData({data:c});f.find(".long_description_holder").toggleClass("empty",!c.long_description);f.find(".ratings").empty();f.toggleClass("learning_outcome_criterion",!!c.learning_outcome_id);for(var g in c.ratings){var h=c.ratings[g];h.rating_id=h.id;var i=a.clone(true);i.toggleClass("edge_rating",g===0||g===c.ratings.length-1);i.fillTemplateData({data:h});f.find(".ratings").append(i)}b.find(".summary").before(f);
f.find(".criterion_points").val(c.points).blur()}b.find(".criterion:not(.blank)").find(".ratings").showIf(!e.free_form_criterion_comments).end().find(".custom_ratings").showIf(e.free_form_criterion_comments)}};rubricEditing.sizeRatings=$.debounce(10,rubricEditing.originalSizeRatings);
