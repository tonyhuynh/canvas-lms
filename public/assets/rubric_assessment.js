var rubricAssessment={init:function(){var b=$("#rubric_criterion_comments_dialog");$(".rubric").delegate(".rating","click",function(){$(this).parents(".criterion").find(".criterion_points").val($(this).find(".points").text()).change()}).delegate(".long_description_link","click",function(a){a.preventDefault();if(!$(this).parents(".rubric").hasClass("editing")){a=$(this).parents(".criterion").getTemplateData({textValues:["long_description","description"]});$("#rubric_long_description_dialog").fillTemplateData({data:a,
htmlValues:["long_description"]}).find(".editing").hide().end().find(".displaying").show().end().dialog("close").dialog({autoOpen:false,title:"Criterion Long Description",width:400}).dialog("open")}}).delegate(".criterion .saved_custom_rating","change",function(){if($(this).parents(".rubric").hasClass("assessing")){var a=$(this).val();a&&a.length>0&&$(this).parents(".custom_ratings_entry").find(".custom_rating_field").val(unescape(a))}}).delegate(".criterion_comments","click",function(a){a.preventDefault();
a.preventDefault();a=$(this).parents(".criterion");var c=a.getTemplateData({textValues:["custom_rating"]}).custom_rating,e=$(this).closest(".displaying").parents(".criterion").length===0;c={criterion_comments:c,criterion_description:a.find(".description:first").text()};b.data("current_rating",a);b.fillTemplateData({data:c});b.fillFormData(c);b.find(".editing").showIf(e);b.find(".displaying").showIf(!e);b.dialog("close").dialog({autoOpen:false,title:"Additional Comments",width:400}).dialog("open")}).find(".criterion_points").bind("keypress change blur",
function(a){a=$(a.target);if(a.parents(".rubric").hasClass("assessing")){var c=parseFloat(a.val(),10);if(isNaN(c))c=null;var e=a.parents(".criterion");e.find(".rating.selected").removeClass("selected");if(c||c===0){e.find(".criterion_description").addClass("completed");e.find(".rating").each(function(){parseFloat($(this).find(".points").text(),10)==c&&$(this).addClass("selected")})}else e.find(".criterion_description").removeClass("completed");var d=0;a.parents(".rubric").find(".criterion:visible:not(.ignore_criterion_for_scoring) .criterion_points").each(function(){var f=
parseFloat($(this).val(),10);if(isNaN(f))f=0;d+=f});a.parents(".rubric").find(".rubric_total").text(d)}});$(".rubric_summary").delegate(".rating_comments_dialog_link","click",function(a){a.preventDefault();a=$(this).parents(".criterion");var c={criterion_comments:a.getTemplateData({textValues:["rating_custom"]}).rating_custom,criterion_description:a.find(".criterion_description:first").text()};b.data("current_rating",a);b.fillTemplateData({data:c});b.fillFormData(c);b.find(".editing").hide();b.find(".displaying").show();
b.dialog("close").dialog({autoOpen:false,title:"Additional Comments",width:400}).dialog("open")});b.find(".save_button").click(function(){var a=b.find("textarea.criterion_comments").val(),c=b.data("current_rating");if(c){c.find(".custom_rating").text(a);c.find(".criterion_comments").toggleClass("empty",!a)}b.dialog("close")});b.find(".cancel_button").click(function(){b.dialog("close")});setInterval(rubricAssessment.sizeRatings,2500)},sizeRatings:function(){if($(".rubric .criterion:visible").length){var b=
$.windowScrollTop();$(".rubric .criterion:visible").each(function(){var a=$(this),c=a.find(".ratings:visible");if(c.length){var e=c.find(".rating .container").css("height","");a=Math.max(c.height(),a.find(".criterion_description .container").height());e.css("height",a-10+"px")}});$("html,body").scrollTop(b)}},assessmentData:function(b){b=rubricAssessment.findRubric(b);var a={};a["rubric_assessment[user_id]"]=rubricAssessment.assessment_user_id||b.find(".user_id").text();a["rubric_assessment[assessment_type]"]=
rubricAssessment.assessment_type||b.find(".assessment_type").text();b.find(".criterion:not(.blank)").each(function(){var c="rubric_assessment["+$(this).attr("id")+"]";a[c+"[points]"]=$(this).find(".criterion_points").val();if($(this).find(".rating.selected")){a[c+"[description]"]=$(this).find(".rating.selected .description").text();a[c+"[comments]"]=$(this).find(".custom_rating").text()}if($(this).find(".custom_rating_field:visible").length>0){a[c+"[comments]"]=$(this).find(".custom_rating_field:visible").val();
a[c+"[save_comment]"]=$(this).find(".save_custom_rating").attr("checked")?"1":"0"}});return a},findRubric:function(b){if(!b.hasClass("rubric")){$new_rubric=b.closest(".rubric");if($new_rubric.length===0)$new_rubric=b.find(".rubric:first");b=$new_rubric}return b},updateRubricAssociation:function(b,a){var c=a.summary_data;if(c&&c.saved_comments)for(var e in c.saved_comments){var d=c.saved_comments[e],f=b.find("#criterion_"+e).find(".saved_custom_rating_holder").hide(),g=f.find(".saved_custom_rating");
g.find(".comment").remove();g.empty().append('<option value="">[ Select ]</option>');for(var h in d)if(d[h]){g.append('<option value="'+escape(d[h])+'">'+$.truncateText(d[h],50)+"</option>");f.show()}}},populateRubric:function(b,a){b=rubricAssessment.findRubric(b);b.attr("id").substring(7);b.find(".user_id").text(rubricAssessment.assessment_user_id||a.user_id).end().find(".assessment_type").text(rubricAssessment.assessment_type||a.assessment_type);b.find(".criterion_description").removeClass("completed").removeClass("original_completed").end().find(".rating").removeClass("selected").removeClass("original_selected").end().find(".custom_rating_field").val("").end().find(".custom_rating_comments").text("").end().find(".criterion_points").val("").change().end().find(".criterion_rating_points").text("").end().find(".custom_rating").text("").end().find(".save_custom_rating").attr("checked",
false);b.find(".criterion_comments").addClass("empty");if(a){var c=0,e;for(e in a.data){var d=a.data[e],f=d.comments_enabled?d.comments:d.description,g=b.find("#criterion_"+d.criterion_id);d.id||g.find(".rating").each(function(){if(parseFloat($(this).find(".points").text(),10)==d.points)d.id=$(this).find(".rating_id").text()});g.find(".criterion_description").addClass("original_completed").end().find("#rating_"+d.id).addClass("original_selected").addClass("selected").end().find(".custom_rating_field").val(f).end().find(".custom_rating_comments").text(f).end().find(".criterion_points").val(d.points).change().end().find(".criterion_rating_points_holder").showIf(d.points||
d.points===0).end().find(".criterion_rating_points").text(d.points).end().find(".custom_rating").text(f).end().find(".criterion_comments").toggleClass("empty",!f).end().find(".save_custom_rating").attr("checked",false);if(d.points)c+=d.points}b.find(".rubric_total").text(c)}},populateRubricSummary:function(b,a){b.find(".criterion_points").text("").end().find(".rating_custom").text("");if(a){var c=0,e;for(e in a.data){var d=a.data[e];b.find("#criterion_"+d.criterion_id).find(".rating").hide().end().find(".rating.description").showIf(!b.hasClass("free_form")).text(d.description).end().find(".rating_"+
d.id).show().end().find(".criterion_points").text(d.points);if(d.comments_enabled&&d.comments){var f=$.truncateText(d.comments,50);b.find("#criterion_"+d.criterion_id).find(".rating_custom").show().text(f)}if(d.points)c+=d.points}b.show().find(".rubric_total").text(c);b.closest(".edit").show()}else b.hide()}};$(function(){rubricAssessment.init()});
