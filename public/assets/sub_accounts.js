jQuery(function(a){a(".add_sub_account_link").click(function(){a("<li class='sub_account'/>").append(a("#account_blank").clone(true).attr("id","account_new").show()).appendTo(a(this).parents(".account:first").children(".sub_accounts")).find(".edit_account_link").click();return false});a(".account .header").hover(function(){a(this).addClass("header_hover")},function(){a(this).removeClass("header_hover")});a(".edit_account_link").click(function(){a(this).parents(".account:first").addClass("editing_account").find(":text:visible:first").focus().select();
return false});a(".account_name").blur(function(){a(this).parents("form").hasClass("saving")||a(this).parents(".account:first").removeClass("editing_account").attr("id")=="account_new"&&a(this).parents(".sub_account:first").remove()}).keycodes("esc",function(){a(this).triggerHandler("blur")});a(".edit_sub_account_form").formSubmit({processData:function(b){b["account[parent_account_id]"]=a(this).parents(".account:first").parents(".account:first").children(".header").getTemplateData({textValues:["id"]}).id;
return b},beforeSubmit:function(){a(this).loadingImage({image_size:"small"}).addClass("saving")},success:function(b){b=b.account;a(this).loadingImage("remove").removeClass("saving");a(this).parents(".header").fillTemplateData({data:b,hrefValues:["id"]}).fillFormData(b,{object_name:"account"}).parents(".account:first").removeClass("editing_account");var c=a.replaceTags(a("#sub_account_urls .sub_account_url").attr("href"),"id",b.id);a(this).attr({action:c,method:"PUT"});a(this).parents(".account:first").attr("id",
"account_"+b.id)}});a(".cant_delete_account_link").click(function(){alert("You can't delete a sub-account that has courses in it");return false});a(".delete_account_link").click(function(){a(this).parents(".account:first").children(".sub_account > li").length?alert("You can't delete a sub-account that has sub_accounts"):a(this).parents("li:first").confirmDelete({url:a(this).parents(".header").find("form").attr("action"),message:"Are you sure you want to delete this sub-account?",success:function(){a(this).slideUp(function(){a(this).remove()})}});
return false});a(".collapse_sub_accounts_link").click(function(){var b=a(this).parents(".header:first");b.closest(".account").children("ul").slideUp();b.find(".expand_sub_accounts_link").show();b.find(".collapse_sub_accounts_link, .add_sub_account_link").hide();return false});a(".expand_sub_accounts_link").click(function(){var b=a(this).parents(".header:first");if(b.parent(".account").children("ul").children(".sub_account").length){b.parent(".account").children("ul").slideDown();b.find(".expand_sub_accounts_link").hide();
b.find(".collapse_sub_accounts_link, .add_sub_account_link").show()}else{b.loadingImage({image_size:"small"});a.ajaxJSON(a(this).attr("href"),"GET",{},function(c){b.loadingImage("remove").find(".expand_sub_accounts_link").hide();b.find(".collapse_sub_accounts_link, .add_sub_account_link").show();b.parent(".account").children("ul").empty().hide();var e=null,d;for(d in c)e=c[d];for(d in e.sub_accounts){c=null;for(var f in e.sub_accounts[d])if(typeof e.sub_accounts[d][f]=="object")c=e.sub_accounts[d][f];
c.courses_count=c.course_count+" Courses";c.sub_accounts_count=c.sub_account_count+" Sub-Accounts";a("<li class='sub_account'/>").append(a("#account_blank").clone(true).attr("id","account_new").show().attr("id","account_"+c.id).fillFormData(c,{object_name:"account"})).fillTemplateData({data:c,hrefValues:["id"]}).appendTo(b.parent(".account").children("ul")).find(".sub_accounts_count").showIf(c.sub_account_count).end().find(".courses_count").showIf(c.course_count).end().find(".collapse_sub_accounts_link").hide().end().find(".expand_sub_accounts_link").showIf(c.sub_account_count>
0).end().find(".add_sub_account_link").showIf(c.sub_account_count==0).end().find(".edit_sub_account_form").attr({action:a.replaceTags(a("#sub_account_urls .sub_account_url").attr("href"),"id",c.id),method:"PUT"})}b.parent(".account").children("ul").slideDown()},function(){})}return false})});
