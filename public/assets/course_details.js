jQuery.cookie=function(d,h,g){if(typeof h!="undefined"){g=g||{};if(h===null){h="";g.expires=-1}var i="";if(g.expires&&(typeof g.expires=="number"||g.expires.toUTCString)){if(typeof g.expires=="number"){i=new Date;i.setTime(i.getTime()+g.expires*864E5)}else i=g.expires;i="; expires="+i.toUTCString()}var j=g.path?"; path="+g.path:"",n=g.domain?"; domain="+g.domain:"";g=g.secure?"; secure":"";document.cookie=[d,"=",encodeURIComponent(h),i,j,n,g].join("")}else{h=null;if(document.cookie&&document.cookie!=
""){g=document.cookie.split(";");for(i=0;i<g.length;i++){j=jQuery.trim(g[i]);if(j.substring(0,d.length+1)==d+"="){h=decodeURIComponent(j.substring(d.length+1));break}}}return h}};
(function(d){var h=d("#email_lists_processed_person_template").removeAttr("id").detach(),g=d("#user_emails_no_valid_emails"),i=d("#user_emails_with_errors"),j=d("#email_lists_processed_people"),n=d("#user_emails_duplicates_found"),f=d("#enroll_users_form"),a=d("#enrollment_blank").removeAttr("id").hide(),c=d("#email_lists_path").attr("href"),e=INST.EmailLists={init:function(){e.showTextarea();f.find(".cancel_button").click(function(){d(".add_users_link").show();f.hide()}).end().find(".go_back_button").click(e.showTextarea).end().find(".verify_syntax_button").click(function(b){b.preventDefault();
e.showProcessing();b={user_emails:d("#user_emails_textarea_container textarea").val().replace(/;/g,",")};d.ajaxJSON(c,"POST",b,e.showResults)}).end().submit(function(b){b.preventDefault();b.stopPropagation();f.find(".add_users_button").text("Adding Users...").attr("disabled",true);b=f.getFormData();var o=f.attr("action"),k={student_enrollment:"Students",teacher_enrollment:"Teachers",ta_enrollment:"TAs"}[b.enrollment_type]||"Users",p=[],m=0,q=0,t=function(){if(m==q)if(p.length){successCount=m-p.length;
var l=[successCount,"out of",m,k,"added"].join(" ");l+=".  The following addresses had problems:<br/><span style='font-size:0.8em;'>"+p.join(",")+"</span>";d.flashError(l,2E4)}else d.flashMessage([m,k,"added"].join(" "));else setTimeout(t,500)},s=[];d("#email_lists_processed_people .person").each(function(){var l={};l.name=d.trim(d(this).find(".name").text());l.email=d.trim(d(this).find(".address").text());s.push(l)});q=s.length;for(var u in s){var r=s[u];b=f.getFormData();b.user_emails=r.email;if(r.name)b.user_emails=
'"'+r.name.replace(/\"/g,"'")+'" <'+r.email+">";d.ajaxJSON(o,"POST",b,function(l){m+=1;if(!l||!l.length)return false;var v=d.underscore(l[0].enrollment.type);f.find(".user_emails").val("");e.showTextarea();d.each(l,function(){e.addUserToList(this.enrollment,v)})},function(){m+=1;p.push(r.email)})}setTimeout(t,500)});f.find("#enrollment_type").change(function(){d("#limit_priveleges_to_course_section_holder").showIf(d(this).val()=="TeacherEnrollment"||d(this).val()=="TaEnrollment")}).change();d(".unenroll_user_link").click(function(b){b.preventDefault();
b.stopPropagation();d(this).hasClass("cant_unenroll")?alert("This user was automatically enrolled using the campus enrollment system, so they can't be manually removed.  Please contact your system administrator if you have questions."):d(this).parents(".user").confirmDelete({message:"Are you sure you want to remove this user?",url:d(this).attr("href"),success:function(){d(this).fadeOut(function(){e.updateCounts()})}})})},showTextarea:function(){f.find(".add_users_button, .go_back_button, #user_emails_parsed").hide();
f.find(".verify_syntax_button, .cancel_button, #user_emails_textarea_container").show().removeAttr("disabled");f.find(".user_emails").removeAttr("disabled").loadingImage("remove").focus().select();f.find(".verify_syntax_button").attr("disabled",false).text("Continue...")},showProcessing:function(){f.find(".verify_syntax_button").attr("disabled",true).text("Processing...");f.find(".user_emails").attr("disabled",true).loadingImage()},showResults:function(b){f.find(".add_users_button, .go_back_button, #user_emails_parsed").show();
f.find(".add_users_button").attr("disabled",false).text("OK Looks Good, Add These "+b.addresses.length+" Users");f.find(".verify_syntax_button, .cancel_button, #user_emails_textarea_container").hide();f.find(".user_emails").removeAttr("disabled").loadingImage("remove");j.html("").show();if(!b||!b.addresses||!b.addresses.length){g.appendTo(j);f.find(".add_users_button").hide()}else{b.errored_addresses&&b.errored_addresses.length&&i.appendTo(j).find(".addresses_count").html(b.addresses.length).end().find(".errors_count").html(b.errored_addresses.length);
if(b.duplicates&&b.duplicates.length)n.appendTo(j).find(".duplicate_count").html(b.duplicates.length).end().find(".duplicates_plurality").html(b.duplicates.length>1?"es":"");d.each(b.addresses,function(){h.clone(true).fillTemplateData({data:this}).appendTo(j).show()})}},updateCounts:function(){d.each(["student","teacher","ta","teacher_and_ta","student_and_observer"],function(){d("."+this+"_count").text(d("."+this+"_enrollments .user:visible").length)})},addUserToList:function(b,o){var k=d(".user_list."+
o+"s");k.length||(k=o=="student_enrollment"||o=="observer_enrollment"?d(".user_list.student_and_observer_enrollments"):d(".user_list.teacher_and_ta_enrollments"));k.find(".none").remove();b.invitation_sent_at="Just Now";try{b.name=b.user.last_name_first||b.user.name;b.pseudonym_id=b.user.pseudonym.id;b.communication_channel_id=b.user.pseudonym.communication_channel.id}catch(p){}var m=null;k.find(".user").each(function(){var q=d(this).getTemplateData({textValues:["name"]}).name;if(q&&b.name&&q.toLowerCase()>
b.name.toLowerCase()){m=d(this);return false}});if(!d("#enrollment_"+b.id).length){b.pseudonym_id=b.users_pseudonym_id;k=a.clone(true).fillTemplateData({textValues:["name"],id:"enrollment_"+b.id,hrefValues:["id","user_id","pseudonym_id","communication_channel_id"],data:b}).addClass(o).removeClass("nil_class user_").addClass("user_"+b.user_id).toggleClass("pending",b.workflow_state!="active")[m?"insertBefore":"appendTo"](m||k).show().animate({backgroundColor:"#FFEE88"},1E3).animate({display:"block"},
2E3).animate({backgroundColor:"#FFFFFF"},2E3,function(){d(this).css("backgroundColor","")});k.parents(".user_list").scrollToVisible(k)}e.updateCounts()}};d(INST.EmailLists.init)})(jQuery,INST);
$(document).ready(function(){var d=$("#add_section_form"),h=$("#edit_section_form"),g=$("#course_form"),i=$(".hashtag_form"),j=$("#course_hashtag"),n=$("#enroll_users_form"),f=$("#enrollment_dialog");$("#course_details_tabs").tabs({cookie:{}}).show();d.formSubmit({required:["course_section[name]"],beforeSubmit:function(){d.find("button").attr("disabled",true).text("Adding Section...")},success:function(a){a=a.course_section;var c=$(".section_blank:first").clone(true).attr("class","section"),e=$("<option/>");
d.find("button").attr("disabled",false).text("Add Section");c.fillTemplateData({data:a,hrefValues:["id"]});$("#course_section_id_holder").show();e.val(a.id).text(a.name).addClass("option_for_section_"+a.id);$("#sections .section_blank").before(c);c.slideDown();$("#course_section_name").val()},error:function(a){d.formErrors(a).find("button").attr("disabled",false).text("Add Section Failed, Please Try Again")}});$(".cant_delete_section_link").click(function(){alert($(this).attr("title"));return false});
h.formSubmit({beforeSubmit:function(a){h.hide();var c=h.parents(".section");c.find(".name").text(a["course_section[name]"]).show();c.loadingImage({image_size:"small"});return c},success:function(a,c){var e=a.course_section;c.loadingImage("remove");$(".option_for_section_"+e.id).text(e.name)},error:function(a,c){c.loadingImage("remove").find(".edit_section_link").click();h.formErrors(a)}}).find(":text").bind("blur",function(){h.submit()}).keycodes("return esc",function(a){if(a.keyString=="return")h.submit();
else{$(this).parents(".section").find(".name").show();$("body").append(h.hide())}});$(".edit_section_link").click(function(){var a=$(this),c=a.parents(".section"),e=c.getTemplateData({textValues:["name"]});h.fillFormData(e,{object_name:"course_section"});c.find(".name").hide().after(h.show());h.attr("action",a.attr("href"));h.find(":text:first").focus().select();return false});$(".delete_section_link").click(function(){$(this).parents(".section").confirmDelete({url:$(this).attr("href"),message:"Are you sure you want to delete this section?",
success:function(){$(this).slideUp(function(){$(this).remove()})}});return false});$("#nav_form").submit(function(){function a(e){if(e=$(e).attr("id")){e=e.split("_");if(e.length>0)return tab_id=parseInt(e.pop(),10)}return null}tab_id_regex=/(\d+)$/;var c=[];$("#nav_enabled_list li").each(function(){var e=a(this);e!==null&&c.push({id:e})});$("#nav_disabled_list li").each(function(){var e=a(this);e!==null&&c.push({id:e,hidden:true})});$("#tabs_json").val(JSON.stringify(c));return true});$(".edit_nav_link").click(function(a){a.preventDefault();
$("#nav_form").dialog("close").dialog({modal:true,resizable:false,width:400}).dialog("open")});$("#nav_enabled_list, #nav_disabled_list").sortable({items:"li.enabled",connectWith:".connectedSortable",axis:"y"}).disableSelection();$(".hashtag_dialog_link").click(function(a){a.preventDefault();$("#hashtag_dialog").dialog("close").dialog({autoOpen:false,title:"What's a Hashtag?",width:500}).dialog("open")});$(".close_dialog_button").click(function(){$("#hashtag_dialog").dialog("close")});$("#course_hashtag").bind("blur change keyup",
function(){var a=$(this).val()||"";a=a.replace(/(\s)+/g,"_").replace(/#/,"");$("#hashtag_options").showIf(a&&a!=="");$(this).val(a)});$(document).fragmentChange(function(a,c){function e(b){$("#tab-users-link").click();$(".add_users_link:visible").click();$("#enroll_users_form select[name='enrollment_type']").val(b)}if(c=="#add_students")e("StudentEnrollment");else if(c=="#add_tas")e("TaEnrollment");else c=="#add_teacher"&&e("TeacherEnrollment")});$(".edit_course_link").click(function(a){var c=$("#course_account_id_lookup");
a.preventDefault();$("#course_form").addClass("editing").find(":text:first").focus().select();c.length&&!c.data("autocomplete")&&c.data("autocomplete",c.autocomplete({serviceUrl:$("#course_account_id_url").attr("href"),onSelect:function(e,b){$("#course_account_id").val(b.id)}}));i.showIf(j.text().length>0);j.triggerHandler("blur")});$(".move_course_link").click(function(a){a.preventDefault();$("#move_course_dialog").dialog("close").dialog({autoOpen:false,title:"Move Course",width:500}).dialog("open")});
$("#move_course_dialog").delegate(".cancel_button","click",function(){$("#move_course_dialog").dialog("close")});g.formSubmit({processData:function(a){a["course[hashtag]"]=(a["course[hashtag]"]||"").replace(/\s/g,"_").replace(/#/g,"");if(a["course[start_at]"])a["course[start_at]"]+=" 12:00am";if(a["course[conclude_at]"])a["course[conclude_at]"]+=" 11:55pm";return a},beforeSubmit:function(a){$(this).loadingImage().removeClass("editing");$(this).find(".readable_license,.account_name,.term_name").text("...");
$(this).find(".quota").text(a["course[storage_quota]"]);$(".course_form_more_options").hide()},success:function(a){$(this).loadingImage("remove");a=a.course;a.start_at=$.parseFromISO(a.start_at).datetime_formatted;a.conclude_at=$.parseFromISO(a.conclude_at).datetime_formatted;a.is_public=a.is_public?"Public":"Private";a.indexed=a.indexed?"Included in public course index":"";$("#course_form .public_options").showIf(a.is_public);$("#course_form .self_enrollment_message").css("display",a.self_enrollment?
"":"none");$("#course_form").fillTemplateData({data:a});$(".hashtag_form").showIf($("#course_hashtag").text().length>0)}}).find(".cancel_button").click(function(){g.removeClass("editing");i.showIf(j.text().length>0);$(".course_form_more_options").hide()}).end().find(":text:not(.date_entry)").keycodes("esc",function(){g.find(".cancel_button:first").click()});n.hide();$(".add_users_link").click(function(a){$(this).hide();a.preventDefault();$("#enroll_users_form").show();$("html,body").scrollTo(n);n.find("textarea").focus().select()});
$(".associate_user_link").click(function(a){a.preventDefault();a=$(this).parents(".user");var c=$("#link_student_dialog");a=a.getTemplateData({textValues:["name","id","associated_user_id","associated_user_name"]});a.existing_user_name=$(".user.user_"+a.associated_user_id+" .name").text()||a.associated_user_name||"User "+a.associated_user_id;c.find(".existing_user").hide();a.associated_user_id&&c.find(".existing_user").show();c.find(".enrollment_id").val(a.id);c.find(".student_options option:not(.blank)").remove();
$(".student_enrollments .user").each(function(){var e=$(this).getTemplateData({textValues:["name","user_id"]}),b=$("<option/>");if(e.user_id&&e.name){b.val(e.user_id).text(e.name);c.find(".student_options").append(b)}});c.find(".student_options").val("none").val(a.associated_user_id);c.fillTemplateData({data:a}).dialog("close").dialog({autoOpen:false,title:"Link to Student",width:400}).dialog("open")});$("#link_student_dialog .cancel_button").click(function(){$("#link_student_dialog").dialog("close")});
$("#link_student_dialog_form").formSubmit({beforeSubmit:function(){$(this).find("button").attr("disabled",true).end().find(".save_button").text("Linking to Student...")},success:function(a){$(this).find("button").attr("disabled",false).end().find(".save_button").text("Link to Student");(a=a.observer_enrollment)&&$("#enrollment_"+a.id).find(".associated_user.associated").showIf(a.associated_user_id).end().find(".associated_user.unassociated").showIf(!a.associated_user_id).end().fillTemplateData({data:a});
$("#link_student_dialog").dialog("close")},error:function(){$(this).find("button").attr("disabled",false).find(".save_button").text("Linking Failed, please try again")}});$(".course_info").attr("title","Click to Edit").click(function(){$(".edit_course_link:first").click();var a=$(this).parents("td").find(".course_form");a.length&&a.focus().select()});$(".course_form_more_options_link").click(function(a){a.preventDefault();$(".course_form_more_options").slideToggle()});$(".user_list").delegate(".user",
"mouseover",function(){var a=$(this),c=a.attr("title");c!="This user has not yet accepted their invitation.  Click to re-send invitation."&&a.data("real_title",c);a.hasClass("pending")?a.attr("title","This user has not yet accepted their invitation.  Click to re-send invitation.").css("cursor","pointer"):a.attr("title",$(this).data("real_title")||"User").css("cursor","")});f.find(".cancel_button").click(function(){f.dialog("close")});$(".user_list").delegate(".user_information_link","click",function(){var a=
$(this).closest(".user"),c=a.hasClass("pending"),e=a.getTemplateData({textValues:["name","invitation_sent_at"]}),b=a.parents(".teacher_enrollments,.ta_enrollments").length>0;e.re_send_invitation_link="Re-Send Invitation";f.data("user",a).find(".re_send_invitation_link").attr("href",a.find(".re_send_confirmation_url").attr("href")).end().find(".student_enrollment_re_send").showIf(c&&!b).end().find(".admin_enrollment_re_send").showIf(c&&b).end().find(".accepted_enrollment_re_send").showIf(!c).end().find(".invitation_sent_at").showIf(c).end().fillTemplateData({data:e}).dialog("close").dialog({autoOpen:false,
title:"Enrollment Details"}).dialog("open");return false});f.find(".re_send_invitation_link").click(function(a){a.preventDefault();var c=$(this);c.text("Re-Sending Invitation...");a=c.attr("href");$.ajaxJSON(a,"POST",{},function(){f.fillTemplateData({data:{invitation_sent_at:"Just Now"}});c.text("Invitation Sent!");var e=f.data("user");e&&e.fillTemplateData({data:{invitation_sent_at:"Just Now"}})},function(){c.text("Invitation Failed.  Please try again.")})});$(".date_entry").date_field();$().data("current_default_wiki_editing_roles",
$("#course_default_wiki_editing_roles").val());$("#course_default_wiki_editing_roles").change(function(){var a=$(this);$(".changed_default_wiki_editing_roles").showIf(a.val()!=$().data("current_default_wiki_editing_roles"));$(".default_wiki_editing_roles_change").text(a.find(":selected").text())});$(".re_send_invitations_link").click(function(a){a.preventDefault();var c=$(this);c.text("Re-Sending Unaccepted Invitations...").attr("disabled",true);$.ajaxJSON(c.attr("href"),"POST",{},function(){c.text("Re-Sent All Unaccepted Invitations!").attr("disabled",
false);$(".user_list .user.pending").each(function(){$(this).fillTemplateData({data:{invitation_sent_at:"Just Now"}})});setTimeout(function(){c.text("Re-Send All Unaccepted Invitations")},2500)},function(){c.text("Send Failed, Please Try Again").attr("disabled",false)})});$("#enrollment_type").change(function(){$(".teacherless_invite_message").showIf($(this).find(":selected").hasClass("teacherless_invite"))});$(".is_public_checkbox").change(function(){$(".public_options").showIf($(this).attr("checked"))}).change();
$(".self_enrollment_checkbox").change(function(){$(".open_enrollment_holder").showIf($(this).attr("checked"))}).change();$.scrollSidebar()});
