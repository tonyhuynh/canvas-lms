$(function(){var f=$(".profile_table"),d=$("#update_profile_form"),i=$("#default_email_id");$(".edit_profile_link").click(function(){f.addClass("editing").find(".edit_data_row").show().end().find(":text:first").focus().select();return false});f.find(".cancel_button").click(function(){f.removeClass("editing").find(".change_password_row,.edit_data_row,.more_options_row").hide().end().find("#change_password_checkbox").attr("checked",false);return false});f.find("#change_password_checkbox").click(function(){INST.browser.ie&&
$(this).triggerHandler("change")}).change(function(a){a.preventDefault();if($(this).attr("checked")){$(this).addClass("showing");f.find(".change_password_row").show().find(":password:first").focus().select()}else f.find(".change_password_row").hide().find(":password").val("")}).attr("checked",false).change();d.attr("method","PUT").formSubmit({required:["name"],object_name:"user",property_validations:{"=default_email_id":function(a){if($("#default_email_id").length&&(!a||a=="new"))return"Please select an option"}},
beforeSubmit:function(){d.loadingImage()},success:function(a){a=a.user;d.loadingImage("remove");if(i.length>0){var b=i.find("option:selected").text();$(".default_email.display_data").text(b)}$(".channel").removeClass("default");$("#channel_"+a.communication_channel.id).addClass("default");d.fillTemplateData({data:{short_name:a.short_name,full_name:a.name,time_zone:a.time_zone}}).find(".cancel_button").click()},error:function(a){d.loadingImage("remove").formErrors(a.errors||a);$(".edit_profile_link").click()}}).find(".more_options_link").click(function(){d.find(".more_options_link_row").hide();
d.find(".more_options_row").show();return false});$("#default_email_id").change(function(){$(this).val()=="new"&&$(".add_email_link:first").click()});$("#unregistered_services li.service").click(function(a){a.preventDefault();$("#"+$(this).attr("id")+"_dialog").dialog("close").dialog({width:350,autoOpen:false}).dialog("open")});$(".create_user_service_form").formSubmit({object_name:"user_service",beforeSubmit:function(){$(this).loadingImage()},success:function(){$(this).loadingImage("remove").parents(".content").dialog("close");
document.location.reload()},error:function(){$(this).loadingImage("remove").errorBox("Registration failed. Check the user name and password, and try again.")}});$("#unregistered_services li.service .content form .cancel_button").click(function(){$(this).parents(".content").dialog("close")});$("#registered_services li.service .delete_service_link").click(function(a){a.preventDefault();$(this).parents("li.service").confirmDelete({message:"Are you sure you want to unregister this service?",url:$(this).attr("href"),
success:function(){$(this).slideUp(function(){$("#unregistered_services").find("#unregistered_"+$(this).attr("id")).slideDown()})}})});$(".service").hover(function(){$(this).addClass("service-hover")},function(){$(this).removeClass("service-hover")});$("#show_user_services").change(function(){$.ajaxJSON($("#update_profile_form").attr("action"),"PUT",{"user[show_user_services]":$(this).attr("checked")},function(){},function(){})});$(".delete_pseudonym_link").click(function(a){a.preventDefault();$(this).parents(".pseudonym").confirmDelete({url:$(this).attr("href"),
message:"Are you sure you want to delete this login?"})});$(document).fragmentChange(function(a,b){var c=b.substring(1);if(c.match(/^register/))c=c.substring(9);$("#unregistered_service_"+c+":visible").length>0&&$("#unregistered_service_"+c+":visible").click()}).fragmentChange();$("#profile_pic_dialog .add_pic_link").click(function(a){a.preventDefault();$("#add_pic_form").slideToggle()});$("#profile_pic_dialog").delegate("img","click",function(){if(!$(this).hasClass("pending")){$("#profile_pic_dialog .img.selected").removeClass("selected");
$(this).parent().addClass("selected");$("#profile_pic_dialog .select_button").attr("disabled",false)}});$("#add_pic_form").formSubmit({fileUpload:true,beforeSubmit:function(){$(this).find("button").attr("disabled",true).text("Adding File...");var a=$("<span class='img'><img/></span>").find("img");a.attr("src","/images/ajax-loader.gif");a.addClass("pending");return a},success:function(a,b){$(this).find("button").attr("disabled",false).text("Add File");var c=a.attachment;if(b){b.removeClass("pending");
b.attr("src","/images/thumbnails/"+c.id+"/"+c.uuid);b.attr("data-type","attachment");b.attr("alt",c.display_name);b[0].onerror=function(){b.attr("src","/images/dotted_pic.png")};$("#profile_pic_dialog .profile_pic_list div").before(b);b.click()}},error:function(a,b){$(this).find("button").attr("disabled",false).text("Adding File Failed");b&&b.remove()}});$("#profile_pic_dialog .cancel_button").click(function(){$("#profile_pic_dialog").dialog("close")});$("#profile_pic_dialog .select_button").click(function(){var a=
$("#update_profile_form").attr("action"),b=$("#profile_pic_dialog");b.find("button").attr("disabled",true).filter(".select_button").text("Selecting Image...");var c=$("#profile_pic_dialog .profile_pic_list .img.selected img");if(c.length!=0){c={"user[avatar_image][url]":c.attr("src"),"user[avatar_image][type]":c.attr("data-type")};$.ajaxJSON(a,"PUT",c,function(e){b.find("button").attr("disabled",false).filter(".select_button").text("Select Image");e=e.user;if(e.avatar_url=="/images/no_pic.gif")e.avatar_url=
"/images/dotted_pic.png";$(".profile_pic_link img").attr("src",e.avatar_url);b.dialog("close")},function(){b.find("button").attr("disabled",false).filter(".select_button").text("Selecting Image Failed, please try again")})}});$(".profile_pic_link").click(function(a){a.preventDefault();var b=$("#profile_pic_dialog");b.find(".img.selected").removeClass("selected");b.find(".select_button").attr("disabled",true);if($(this).hasClass("locked"))alert("Your profile picture has been locked by an administrator, and cannot be changed.");
else{if(!b.hasClass("loaded")){b.find(".profile_pic_list h3").text("Loading Images...");$.ajaxJSON($(".profile_pics_url").attr("href"),"GET",{},function(c){if(c&&c.length>0){b.addClass("loaded");b.find(".profile_pic_list h3").remove();for(var e in c){var g=c[e],h=$("<span class='img'><img/></span>");$img=h.find("img");$img.attr("src",g.url);$img.attr("alt",g.alt||g.type);$img.attr("title",g.alt||g.type);$img.attr("data-type",g.type);$img[0].onerror=function(){h.remove()};b.find(".profile_pic_list div").before(h)}}else b.find(".profile_pic_list h3").text("Loading Images Failed, please try again")},
function(){b.find(".profile_pic_list h3").text("Loading Images Failed, please try again")})}$("#profile_pic_dialog").dialog("close").dialog({autoOpen:false,title:"Select Profile Pic",width:500,height:300}).dialog("open")}});var j=function(){var a=$(".profile_pic_link img")[0];if(a)if(a.complete){if(a.width<5)a.src="/images/dotted_pic.png"}else setTimeout(j,500)};setTimeout(j,500)});
