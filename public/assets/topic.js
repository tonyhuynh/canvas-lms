var wikiSidebar;
(function(){function b(g,k){var c=$("#add_entry_form").clone(true);g.attr("id")=="entry_id"&&g.attr("id","entry_new");var f=g.attr("id");c.addClass("add_entry_form_new").attr("id","add_entry_form_"+f).find(".entry_content").addClass("entry_content_new").attr("id","entry_content_"+f);var i=g.getTemplateData({textValues:["title","parent_id","attachment_name"],htmlValues:["message"]});i.message=g.find(".content > .message_html").val();if(k&&k.message)i.message=k.message;var n="Update",m="Update Entry";
c.attr("method","PUT").attr("action",g.find(".edit_entry_url").attr("href"));c.find(".entry_remove_attachment").val("0");c.find(".add_attachment").show().end().find(".no_attachment").showIf(!i.attachment_name).end().find(".current_attachment").showIf(i.attachment_name).end().find(".upload_attachment").hide().end().find(".attachment_name").text(i.attachment_name);if(g.attr("id")=="entry_new"){n="Add New";m="Add Entry";g.find(".user_name").text($(".current_user_name").text()).attr("href",function(o,
p){return $.replaceTags(p,"user_id",$("#identity .user_id").text())});c.attr("method","POST").attr("action",$("#topic_urls .add_entry_url").attr("href"))}c.fillFormData(i,{object_name:"discussion_entry"});g.children(".content").show().children(".subcontent").hide().end().find(".message").hide().end().append(c.show()).end().children(".header").find(".post_date").hide().end().find(".link_box").hide().end().find(".title").hide().end().prepend("<div class='add_message title' style='float: left; padding-right: 20px;'>"+
n+" Entry</div>").show();c.find(".entry_content_new").editorBox().editorBox("set_code",i.message);if(wikiSidebar){wikiSidebar.attachToEditor(c.find(".entry_content_new"));$("#sidebar_content").hide();wikiSidebar.show()}c.find("button[type='submit']").val(m);setTimeout(function(){h("entry_content_"+f)},500);j(g);$("html,body").scrollTo(c)}function h(g){$("#"+g).editorBox("focus")||setTimeout(function(){h(g)},500)}function a(){var g=$(".add_entry_form_new"),k=g.parents(".discussion_entry");g.find(".entry_content_new").editorBox("destroy");
g.hide();if(wikiSidebar){$("#sidebar_content").show();wikiSidebar.hide()}k.children(".header").show().find(".post_date").show().end().find(".add_message").remove().end().find(".title").show().end().find(".link_box").show().end().end().children(".content").show().children(".subcontent").show().end().find(".message").show().end();g.appendTo($("body"))}function d(){var g=$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");if(g.length===0)g=$(".discussion_topic:first").addClass("selected");
else{for(var k=$(".discussion_topic,.discussion_entry,.communication_sub_message"),c=null,f=$(".discussion_topic,.discussion_entry,.communication_sub_message").index(g.get(0))-1;f>=0;f--){var i=$(k.get(f));if(i.css("display")!="none"){c=i;break}}if(c)g=c}j(g,true)}function e(){$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected").removeClass("selected")}function j(g,k){$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");
e();if(g.length===0)g=$(".discussion_topic:first").addClass("selected");else g.addClass("selected");if(k){$("html,body").scrollTo(g);g.mouseover();g.find(":tabbable:visible:first").focus()}}function l(g){var k=$("#entry_list").children(".discussion_entry");k.removeClass("discussion_start").removeClass("discussion_end");k.length===0?$(".discussion_topic").addClass("discussion_end"):$(".discussion_topic").removeClass("discussion_end");k.filter(":last").addClass("discussion_end");$(".message_count").text(messageCount);
$(".message_count_text").text(messageCount==1?"post":"posts");$(".total_message_count").text(totalMessageCount);if(g){k=g.children(".discussion_entry");k.removeClass("discussion_start").removeClass("discussion_end");k.filter(":first").addClass("discussion_start");k.filter(":last").addClass("discussion_end");k=g.children(".discussion_entry").length;if(g.prev(".discussion_entry").hasClass("has_loaded")){g=g.prev(".discussion_entry");if(k===0)k="No Replies";else if(k===1)k="1 Reply";else k+=" Replies";
g.fillTemplateData({data:{replies:k}})}}}$(document).ready(function(){setTimeout(function(){$(".communication_sub_message.blank").each(function(){var c=$("#discussion_topic_permissions .user_name").clone(true);$(this).find(".user_name").after(c).remove()})},500);var g=[];$.ajaxJSON($(".discussion_entry_permissions_url").attr("href"),"GET",{},function(c){for(var f in c){var i=c[f].discussion_entry;g.push({id:"entry_"+i.id,permissions:i.permissions||{}})}setTimeout(k,500)},function(){});var k=function(){for(var c=
0;c<10;c++){var f=g.shift();if(f){var i=f.permissions;f=f.id;if(i.update||i["delete"]||i.reply){f=$("#"+f);i.update&&f.find(".header .edit_entry_link").removeClass("disabled_link");i["delete"]&&f.find(".header .delete_entry_link").removeClass("disabled_link");if(i.reply){f.find(".add_entry_link").removeClass("disabled_link");f.find(".reply_message").show()}}}}g.length>0&&setTimeout(k,500)};$(".show_rubric_link").click(function(){$("#rubric_dialog").dialog("close").dialog({title:"Assignment Rubric Details",
width:600,modal:false,resizable:true,autoOpen:false}).dialog("open")});$("#add_entry_form .add_attachment_link").click(function(c){c.preventDefault();c=$(this).parents("form");c.find(".no_attachment").slideUp().addClass("current");c.find(".current_attachment").hide().removeClass("current");c.find(".upload_attachment").slideDown()});$("#add_entry_form .delete_attachment_link").click(function(c){c.preventDefault();c=$(this).parents("form");c.find(".current_attachment").slideUp().removeClass("current");
c.find(".no_attachment").slideDown().addClass("current");c.find(".upload_attachment").hide();c.find(".entry_remove_attachment").val("1")});$("#add_entry_form .replace_attachment_link").click(function(c){c.preventDefault();c=$(this).parents("form");c.find(".upload_attachment").slideDown();c.find(".no_attachment").hide().removeClass("current");c.find(".current_attachment").slideUp().addClass("current")});$("#add_entry_form .cancel_attachment_link").click(function(c){c.preventDefault();c=$(this).parents("form");
c.find(".no_attachment.current").slideDown();c.find(".upload_attachment").slideUp();c.find(".current_attachment.current").slideDown();c.find(".attachment_uploaded_data").val("");c.find(".entry_remove_attachment").val("0")});$("#add_entry_form").formSubmit({fileUpload:function(c){(c=c["attachment[uploaded_data]"])&&$(this).attr("action",$(this).attr("action")+".text");return c},object_name:"discussion_entry",processData:function(){var c=$(this).getFormData({object_name:"discussion_entry"});c.message=
$(this).find(".entry_content_new").editorBox("get_code");c["discussion_entry[message]"]=c.message;return c},beforeSubmit:function(c){var f=$(this).parents(".discussion_entry"),i="Updating...";if(f.attr("id")=="entry_new"){i="Adding...";f.attr("id","entry_id")}f.next().attr("id","replies_entry_id");c.post_date=i;f.fillTemplateData({data:c,htmlValues:["message"],avoid:".subcontent"});a();c=f.parents(".discussion_subtopic");l(c);f.find(".content").loadingImage();return f},success:function(c,f){var i=
c.discussion_entry;i.user_name=i.user_name?i.user_name:"User Name";delete i.user;var n=$.parseFromISO(i.created_at,"event");i.post_date=n.datetime_formatted;if(f.attr("id")=="entry_id"){totalMessageCount++;f.parents(".discussion_subtopic").length===0&&messageCount++;l()}if(i.attachment){i.attachment_name=i.attachment.display_name;n=$.replaceTags(f.find(".entry_attachment_url").attr("href"),"attachment_id",i.attachment.id);f.find(".attachment_name").attr("href",n)}f.find(".attachment_data").showIf(i.attachment);
f.find("input.parent_id").val(i.id);f.find("span.parent_id").text(i.id);f.find(".content > .message_html").val(i.message);f.fillTemplateData({id:"entry_"+i.id,data:i,htmlValues:["message"],hrefValues:["id","user_id","discussion_topic_id"],avoid:".subcontent"});f.find(".add_entry_link").toggleClass("disabled_link",!i.permissions.reply).end().find(".edit_entry_link").toggleClass("disabled_link",!i.permissions.update).end().find(".delete_entry_link").toggleClass("disabled_link",!i.permissions["delete"]);
f.find(".content").loadingImage("remove");f.find(".user_content").removeClass("enhanced");$(document).triggerHandler("user_content_change")},error:function(c,f){f.find(".content").loadingImage("remove");b(f);f.attr("id")=="entry_id"&&f.attr("id","entry_new");return f.find("form")}});$("#add_entry_form .cancel_button").click(function(){var c=$(this).parents(".discussion_entry");a();if(c.attr("id")=="entry_new"){d();var f=c.parents(".discussion_subtopic:first");c.next().remove();c.remove();l(f)}});
$(".add_entry_link").live("click",function(c,f){c.preventDefault();c.stopPropagation();if(!($("#entry_new").length>0)){var i=$("#entry_list"),n={parent_id:0};if($(this).parents(".discussion_subtopic").length>0){i=$(this).parents(".discussion_subtopic");n.parent_id=i.prev().getTemplateData({textValues:["id"]}).id}else if($(this).parents(".discussion_entry").length>0){i=$(this).parents(".discussion_entry").next();n.parent_id=i.prev().getTemplateData({textValues:["id"]}).id}var m=i.prev(".discussion_entry");
if(!(m.length>0&&m.find(".replies_link").text()!="No Replies"&&!m.hasClass("has_loaded"))){m=$("#entry_blank").clone(true);var o=$("#replies_entry_blank").clone(true);m.fillTemplateData({data:n});i.append(m.show());i.append(o);l(m.parents(".discussion_subtopic:first"));m.attr("id","entry_new");b(m,f)}}});$(".switch_entry_views_link").live("click",function(c){c.preventDefault();$(this).parents("form").find("textarea").editorBox("toggle")});$(".edit_entry_link").live("click",function(c){c.preventDefault();
if($(this).parents(".discussion_entry").length>0){c=$(this).parents(".discussion_entry");b(c)}else $(".discussion_topic:first .edit_topic_link").click()});$(".delete_entry_link").live("click",function(c){c.preventDefault();c=$("#add_entry_form").getFormData({values:["authenticity_token"]});$(this).closest(".discussion_entry,.communication_sub_message").confirmDelete({token:c.authenticity_token,url:$(this).attr("href"),message:"Are you sure you want to delete this entry?",success:function(){$(this).fadeOut("normal",
function(){var f=$(this).parents(".discussion_subtopic:first");$(this).remove();l(f)});totalMessageCount--;$(this).parents(".discussion_subtopic").length===0&&messageCount--;l()}})});$("#entry_list").delegate(".replies_link","click",function(c){c.preventDefault()});$(".toggle_subtopics_link").live("click",function(c){c.preventDefault();$(this).text().indexOf("Expand");$(".toggle_subtopics_link").toggle()});$(document).click(function(c){$(c.target).parents(".discussion_entry,.discussion_topic").length===
0?e():j($(c.target).closest(".communication_sub_message,.discussion_entry,.discussion_topic").filter(":first"))});$.scrollSidebar();$("#add_entry_form :input").keydown(function(c,f){if(c.keyCode==27||f==27){c.preventDefault();var i=$(this).parents("form").attr("id");setTimeout("cancelEditEntry('"+i+"')",100)}});$(document).fragmentChange(function(c,f){if(f.match(/^#reply/)){var i=null;try{i=JSON.parse(f.substring(6))}catch(n){}$("#sidebar .add_entry_link:visible:first").triggerHandler("click",i)}});
$(document).keycodes("j k d e r n",function(c){c.preventDefault();c.stopPropagation();var f=$(".discussion_entry,.discussion_topic,.communication_sub_message").filter(".selected:first");if(c.keyCode==74){c=$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");if(c.length===0)c=$(".discussion_topic:first").addClass("selected");else{f=$(".discussion_topic,.discussion_entry,.communication_sub_message");for(var i=null,n=$(".discussion_topic,.discussion_entry,.communication_sub_message").index(c.get(0))+
1;n<f.length;n++){var m=$(f.get(n));if(m.css("display")!="none"){i=m;break}}if(i)c=i}j(c,true)}else if(c.keyCode==75)d();else if(c.keyCode==68)f.find(".delete_topic_link,.delete_entry_link").clickLink();else if(c.keyCode==69)f.find(".edit_topic_link,.edit_entry_link").clickLink();else if(c.keyCode==82){f.find(".add_entry_link").length?f.find(".add_entry_link").clickLink():f.closest(".communication_message").find(".add_entry_link").clickLink();c=$(".add_sub_message_form,.new_discussion_entry").filter(":visible:first");
c.length&&$("html,body").scrollTo(c)}else c.keyCode==78&&$(document).find(".add_entry_link:first").clickLink()})})})();var limitToOneRubric;
$(document).ready(function(){var b=$("#rubric_dialog"),h=$("#rubric_long_description_dialog");rubricEditing.htmlBody=$("html,body");$("#rubrics").delegate(".long_description_link","click",function(a){a.preventDefault();a=$(this).parents(".rubric").hasClass("editing");var d=$(this).parents(".criterion"),e=d.getTemplateData({textValues:["long_description","description"]});e.long_description=d.find("textarea.long_description").val();h.data("current_criterion",d).fillTemplateData({data:e,htmlValues:["long_description"]}).fillFormData(e).find(".editing").showIf(a&&
!d.hasClass("learning_outcome_criterion")).end().find(".displaying").showIf(!a||d.hasClass("learning_outcome_criterion")).end().dialog("close").dialog({autoOpen:false,title:"Criterion Long Description",width:400}).dialog("open").find("textarea:visible:first").focus().select()}).delegate(".find_rubric_link","click",function(a){a.preventDefault();b.dialog("close").dialog({autoOpen:true,width:800,height:380,resizable:true,title:"Find Existing Rubric"}).dialog("open");if(!b.hasClass("loaded")){b.find(".loading_message").text("Loading rubric groups...");
a=b.find(".grading_rubrics_url").attr("href");$.ajaxJSON(a,"GET",{},function(d){for(var e in d){var j=d[e],l=b.find(".rubrics_dialog_context_select.blank:first").clone(true).removeClass("blank");l.fillTemplateData({data:{name:j.name,context_code:j.context_code,rubrics:j.rubrics+" rubrics"}});b.find(".rubrics_dialog_contexts_select").append(l.show())}d.length==0?b.find(".loading_message").text("No rubrics found"):b.find(".loading_message").remove();b.find(".rubrics_dialog_rubrics_holder").slideDown();
b.find(".rubrics_dialog_contexts_select .rubrics_dialog_context_select:visible:first").click();b.addClass("loaded")},function(){b.find(".loading_message").text("Loading rubrics failed, please try again")})}}).delegate(".edit_rubric_link","click",function(){var a=$(this);if(!a.hasClass("copy_edit")||confirm("You can't edit this rubric, either because you don't have permission or it's being used in more than one place. Any changes you make will result in a new rubric based on the old rubric.  Continue anyway?"))rubricEditing.editRubric(a.parents(".rubric"),
a.attr("href"));return false});$(".rubric .delete_rubric_link").bind("click",function(a,d){a.preventDefault();var e="Are you sure you want to delete this rubric?";if(d&&d.confirmationMessage)e=d.confirmationMessage;$(this).parents(".rubric").confirmDelete({url:$(this).attr("href"),message:e,success:function(){$(this).fadeOut(function(){$(".add_rubric_link").slideDown();d&&$.isFunction(d)&&d()})}})});h.find(".save_button").click(function(){var a=h.find("textarea.long_description").val(),d=h.data("current_criterion");
if(d){d.fillTemplateData({data:{long_description:a}});d.find("textarea.long_description").val(a);d.find(".long_description_holder").toggleClass("empty",!a)}h.dialog("close")});h.find(".cancel_button").click(function(){h.dialog("close")});$(".add_rubric_link").click(function(a){a.preventDefault();if(!($("#rubric_new").length>0))if(!(limitToOneRubric&&$("#rubrics .rubric:visible").length>0)){a=rubricEditing.addRubric();$("#rubrics").append(a.show());a.find(":text:first").focus().select();limitToOneRubric&&
$(".add_rubric_link").hide()}});$("#rubric_dialog").delegate(".rubrics_dialog_context_select","click",function(a){a.preventDefault();$(".rubrics_dialog_contexts_select .selected_side_tab").removeClass("selected_side_tab");var d=$(this);d.addClass("selected_side_tab");var e=d.getTemplateData({textValues:["context_code"]}).context_code;if(d.hasClass("loaded")){b.find(".rubrics_loading_message").hide();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();
b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+e).show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()}else{b.find(".rubrics_loading_message").text("Loading rubrics...").show();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").hide();a=b.find(".grading_rubrics_url").attr("href")+"?context_code="+e;$.ajaxJSON(a,"GET",{},function(j){d.addClass("loaded");b.find(".rubrics_loading_message").hide();b.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();
for(var l in j){var g=j[l].rubric_association,k=g.rubric,c=b.find(".rubrics_dialog_rubric_select.blank:first").clone(true);c.addClass(g.context_code);k.criterion_count=k.data.length;c.fillTemplateData({data:k}).removeClass("blank");b.find(".rubrics_dialog_rubrics_select").append(c.show());g=b.find(".rubrics_dialog_rubric.blank:first").clone(true);g.removeClass("blank");g.find(".criterion.blank").hide();k.rubric_total=k.points_possible;g.fillTemplateData({data:k,id:"rubric_dialog_"+k.id});for(l in k.data){var f=
k.data[l];f.criterion_points=f.points;f.criterion_points_possible=f.points;f.criterion_description=f.description;c=f.ratings;delete f.ratings;var i=g.find(".criterion.blank:first").clone().removeClass("blank");i.fillTemplateData({data:f});i.find(".rating_holder").addClass("blank");for(var n in c){f=c[n];var m=i.find(".rating_holder.blank:first").clone().removeClass("blank");f.rating=f.description;m.fillTemplateData({data:f});i.find(".ratings").append(m.show())}i.find(".rating_holder.blank").remove();
g.find(".rubric.rubric_summary tr.summary").before(i.show())}b.find(".rubrics_dialog_rubrics").append(g)}b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+e).show();b.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()},function(){b.find(".rubrics_loading_message").text("Loading rubrics failed, please try again")})}}).delegate(".rubrics_dialog_rubric_select","click",
function(a){a.preventDefault();a=$(this);a.find("a").focus();var d=a.getTemplateData({textValues:["id"]}).id;$(".rubric_dialog .rubrics_dialog_rubric_select").removeClass("selected_side_tab");a.addClass("selected_side_tab");$(".rubric_dialog .rubrics_dialog_rubric").hide();$(".rubric_dialog #rubric_dialog_"+d).show()}).delegate(".select_rubric_link","click",function(a){a.preventDefault();a={};var d=b.getTemplateData({textValues:["rubric_association_type","rubric_association_id","rubric_association_purpose"]});
a["rubric_association[association_type]"]=d.rubric_association_type;a["rubric_association[association_id]"]=d.rubric_association_id;a["rubric_association[rubric_id]"]=$(this).parents(".rubrics_dialog_rubric").getTemplateData({textValues:["id"]}).id;a["rubric_association[purpose]"]=d.rubric_association_purpose;b.loadingImage();d=b.find(".select_rubric_url").attr("href");$.ajaxJSON(d,"POST",a,function(e){b.loadingImage("remove");var j=$("#rubrics .rubric:visible:first");if(j.length===0)j=rubricEditing.addRubric();
var l=e.rubric;l.rubric_association_id=e.rubric_association.id;l.permissions=l.permissions||{};if(e.rubric_association.permissions){l.permissions.update_association=e.rubric_association.permissions.update;l.permissions.delete_association=e.rubric_association.permissions["delete"]}rubricEditing.updateRubric(j,l);rubricEditing.hideEditRubric(j,false);b.dialog("close")},function(){b.loadingImage("remove")})});b.find(".cancel_find_rubric_link").click(function(a){a.preventDefault();b.dialog("close")});
b.find(".rubric_brief").find(".expand_data_link,.collapse_data_link").click(function(a){a.preventDefault();$(this).parents(".rubric_brief").find(".expand_data_link,.collapse_data_link").toggle().end().find(".details").slideToggle()});$("#edit_rubric_form").formSubmit({processData:function(a){a=$(this).parents(".rubric");if(a.find(".criterion:not(.blank)").length===0)return false;a=rubricEditing.rubricData(a);if(a["rubric_association[use_for_grading]"]=="1"){var d=parseFloat($("#full_assignment .points_possible").text()),
e=parseFloat(a.points_possible);if(d&&e!=d)if(!confirm("The points total does not match the assignment's points.  Do you want to change the assignment's points to match the rubric score?"))return false}return a},beforeSubmit:function(a){var d=$(this).parents(".rubric");d.find("thead .title").text(a["rubric[title]"]);d.find(".rubric_total").text(a.points_possible);d.removeClass("editing");d.attr("id")=="rubric_new"?d.attr("id","rubric_adding"):d.prev(".rubric").remove();$(this).parents("tr").hide();
d.loadingImage();return d},success:function(a,d){var e=a.rubric;d.loadingImage("remove");e.rubric_association_id=a.rubric_association.id;e.permissions=e.permissions||{};if(a.rubric_association.permissions){e.permissions.update_association=a.rubric_association.permissions.update;e.permissions.delete_association=a.rubric_association.permissions["delete"]}rubricEditing.updateRubric(d,e);if(a.rubric_association&&a.rubric_association.use_for_grading){$("#full_assignment .points_possible").text(e.points_possible);
$("#full_assignment input.points_possible").val(e.points_possible)}d.find(".rubric_title .links:not(.locked)").show()}});$("#edit_rubric_form .cancel_button").click(function(){rubricEditing.hideEditRubric($(this).parents(".rubric"),true)});$("#find_outcome_criterion_dialog .outcomes_select").click(function(a){a.preventDefault();$("#find_outcome_criterion_dialog .outcomes_select.selected_side_tab").removeClass("selected_side_tab");$(this).addClass("selected_side_tab");a=$(this).getTemplateData({textValues:["id"]}).id;
$("#find_outcome_criterion_dialog .outcomes_list .outcome").hide();$("#find_outcome_criterion_dialog .outcomes_list .outcome_"+a).show()});$("#find_outcome_criterion_dialog .select_outcome_link").click(function(a){a.preventDefault();var d=$(this).parents(".outcome");if($("#find_outcome_criterion_dialog").data("current_rubric")){a=$("#find_outcome_criterion_dialog").data("current_rubric");var e=d.find(".learning_outcome_id").text();a.find(".criterion.learning_outcome_"+e).find(".delete_criterion_link").click();
$("#find_outcome_criterion_dialog").dialog("close");a.find(".add_criterion_link").click();a=a.find(".criterion:not(.blank):last");a.toggleClass("ignore_criterion_for_scoring",!d.find(".criterion_for_scoring").attr("checked"));a.find(".mastery_points").val(d.find(".mastery_points").text());a.addClass("learning_outcome_criterion");a.find(".learning_outcome_id").text(e);a.find(".criterion_points").val(d.find(".rating:not(.blank):first .points").text()).blur();for(e=0;e<d.find(".rating:not(.blank)").length-
2;e++)a.find(".rating:not(.blank):first").addClass("add_column").click();a.find(".rating:not(.blank)").each(function(l){l=d.find(".rating:not(.blank)").eq(l).getTemplateData({textValues:["description","points"]});$(this).fillTemplateData({data:l})});e=d.find(".body.description").html();var j=d.find(".mastery_points").text();a.find(".cancel_button").click();a.find(".long_description").val(e);a.find(".long_description_holder").toggleClass("empty",!e);a.find(".criterion_description_value").text(d.find(".short_description").text());
a.find(".criterion_description").val(d.find(".short_description").text()).focus().select();a.find(".mastery_points").text(j)}});$("#rubrics").delegate(".add_criterion_link","click",function(){var a=rubricEditing.addCriterion($(this).parents(".rubric"));rubricEditing.editCriterion(a);return false}).delegate(".find_outcome_link","click",function(){rubricEditing.findOutcomeCriterion($(this).parents(".rubric"));return false}).delegate(".criterion_description_value","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));
return false}).delegate(".edit_criterion_link","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));return false}).delegate(".delete_criterion_link","click",function(){var a=$(this).parents(".criterion");a.fadeOut(function(){var d=a.parents(".rubric");a.remove();rubricEditing.updateCriteria(d);rubricEditing.updateRubricPoints(d)});return false}).delegate(".rating_description_value,.edit_rating_link","click",function(){rubricEditing.editRating($(this).parents(".rating"));return false}).bind("mouseover",
function(a){$target=$(a.target);$target.closest(".ratings").length||rubricEditing.hideCriterionAdd($target.parents(".rubric"))}).delegate(".rating","mousemove",function(a){var d=$(this),e=d.parents(".rubric");if(e.find(".rating.editing").length>0||d.parents(".criterion").hasClass("learning_outcome_criterion")){rubricEditing.hideCriterionAdd(e);return false}if(!$.data(this,"hover_offset")){$.data(this,"hover_offset",d.offset());$.data(this,"hover_width",d.outerWidth());var j=$.data(this,"points",parseFloat(d.find(".points").text())),
l=$.data(this,"prev_points",parseFloat(d.prev(".rating").find(".points").text())),g=$.data(this,"next_points",parseFloat(d.next(".rating").find(".points").text()));$.data(this,"prev_diff",Math.abs(j-l));$.data(this,"next_diff",Math.abs(j-g))}j=$.data(this,"hover_offset");l=$.data(this,"hover_width");g=d.parents(".ratings");a=a.pageX;var k=false;if(a<=j.left+l/2)k=true;var c=g.data("hover_rating");g=g.data("hover_left_side");if(!c||d[0]!=c[0]||k!=g){rubricEditing.hideCriterionAdd(e);var f,i;if(k&&
(f=d.prev(".rating"))&&f.length){d.addClass("add_left");f.addClass("add_right");d[a<=j.left+10?"addClass":"removeClass"]("add_column")}else if(!k&&(i=d.next(".rating"))&&i.length){d.addClass("add_right");i.addClass("add_left");d[a>=j.left+l-10?"addClass":"removeClass"]("add_column")}}else if(c)if(k)a<=j.left+10&&$.data(this,"prev_diff")>1?d.addClass("add_column"):d.removeClass("add_column");else a>=j.left+l-10&&$.data(this,"next_diff")>1?d.addClass("add_column"):d.removeClass("add_column");return false}).delegate(".rating",
"mouseout",function(){$(this).data("hover_offset",null).data("hover_width",null)}).delegate(".delete_rating_link","click",function(a){a.preventDefault();rubricEditing.hideCriterionAdd($(this).parents(".rubric"));$(this).parents(".rating").fadeOut(function(){var d=$(this).parents(".criterion");$(this).remove();rubricEditing.sizeRatings(d)})}).delegate(".add_column","click",function(){var a=$(this),d=a.parents(".rubric");if(d.hasClass("editing")){var e=a.clone(true).removeClass("edge_rating"),j=parseFloat(a.find(".points").text()),
l=a.parents(".criterion"),g=l.find(".criterion_points"),k=parseFloat(g.val(),10)||5,c={description:"Rating Description"},f=a.hasClass("add_left");if(a.hasClass("add_left")){g=parseFloat(a.prev(".rating").find(".points").text());c.points=Math.round((j+g)/2);if(c.points==j||c.points==g){c.points=g;l.find(".criterion_points").val(k+1)}}else{var i=parseFloat(a.next(".rating").find(".points").text());c.points=Math.round((j+i)/2);if(c.points==j||c.points==i){c.points=j;g.val(k+1)}}e.fillTemplateData({data:c});
f?a.before(e):a.after(e);rubricEditing.hideCriterionAdd(d);rubricEditing.updateCriterionPoints(l);rubricEditing.sizeRatings(l)}return false});$(".criterion_points").keydown(function(a){if(a.keyCode==13){rubricEditing.updateCriterionPoints($(this).parents(".criterion"));$(this).blur()}}).blur(function(){rubricEditing.updateCriterionPoints($(this).parents(".criterion"))});$("#edit_criterion").delegate(".cancel_button","click",function(){rubricEditing.hideEditCriterion()});$("#edit_criterion_form").submit(function(a){a.preventDefault();
a.stopPropagation();a=$(this).parents("#edit_criterion").getFormData();a.criterion_description_value=a.description;delete a.description;$(this).parents(".criterion").fillTemplateData({data:a});rubricEditing.hideEditCriterion()});$("#edit_rating").delegate(".cancel_button","click",function(){rubricEditing.hideEditRating()});$("#edit_rating_form").submit(function(a){a.preventDefault();a.stopPropagation();a=$(this).parents("#edit_rating").getFormData();a.points=parseFloat(a.points);if(isNaN(a.points)){a.points=
parseFloat($(this).parents(".criterion").find(".criterion_points").val());if(isNaN(a.points))a.points=5}var d=$(this).parents(".rating");d.fillTemplateData({data:a});d.prev(".rating").length===0&&$(this).parents(".criterion").find(".criterion_points").val(a.points);rubricEditing.updateCriterionPoints($(this).parents(".criterion"),true)});$("#edit_rubric_form .rubric_custom_rating").change(function(){$(this).parents(".rubric").find("tr.criterion").find(".ratings").showIf(!$(this).attr("checked")).end().find(".custom_ratings").showIf($(this).attr("checked"))}).triggerHandler("change");
$("#edit_rubric_form #totalling_rubric").change(function(){$(this).parents(".rubric").find(".total_points_holder").showIf(!$(this).attr("checked"))});$("#edit_rubric_form .grading_rubric_checkbox").change(function(){$(this).parents(".rubric").find(".totalling_rubric").css("visibility",$(this).attr("checked")?"hidden":"visible");$(this).parents(".rubric").find(".totalling_rubric_checkbox").attr("checked",false)}).triggerHandler("change");$("#criterion_blank").find(".criterion_points").val("5");$("#default_rubric").find(".criterion").length<=
1&&rubricEditing.addCriterion($("#default_rubric"));setInterval(rubricEditing.sizeRatings,1E4)});
var rubricEditing={htmlBody:null,updateCriteria:function(b){b.find(".criterion:not(.blank)").each(function(h){$(this).attr("id","criterion_"+(h+1))})},addCriterion:function(b){var h=b.find(".criterion.blank:first").clone(true);h.removeClass("blank");b.find(".summary").before(h.show());rubricEditing.updateCriteria(b);rubricEditing.updateRubricPoints(b);rubricEditing.sizeRatings(h);return h},findOutcomeCriterion:function(b){var h=$("#find_outcome_criterion_dialog");h.data("current_rubric",b);if(!h.hasClass("loaded")){h.find(".loading_message").text("Loading Outcomes...");
$.ajaxJSON(h.find(".outcomes_list_url").attr("href"),"GET",{},function(a){valids=[];for(var d in a){var e=a[d].learning_outcome;e.data&&e.data.rubric_criterion&&valids.push(e)}if(valids.length===0)h.find(".loading_message").text("No Rubric-Configured Outcomes found");else{h.find(".loading_message").hide();h.addClass("loaded");for(d in valids){e=valids[d];e.name=e.short_description;e.mastery_points=e.data.rubric_criterion.mastery_points||e.data.rubric_criterion.points_possible;a=h.find(".outcomes_select.blank:first").clone(true).removeClass("blank");
e.title=e.short_description;var j=$("<div/>");j.html(e.short_description);e.title=$.truncateText($.trim(j.text()),35);e.display_name=e.cached_context_short_name||"";a.fillTemplateData({data:e});h.find(".outcomes_selects").append(a.show());a=h.find(".outcome.blank:first").clone(true).removeClass("blank");e.learning_outcome_id=e.id;a.fillTemplateData({data:e,htmlValues:["description"]});a.addClass("outcome_"+e.id);if(e.data&&e.data.rubric_criterion)for(var l in e.data.rubric_criterion.ratings){j=e.data.rubric_criterion.ratings[l];
var g=a.find(".rating.blank").clone(true).removeClass("blank");g.fillTemplateData({data:j});a.find("tr").append(g.show())}h.find(".outcomes_list").append(a)}h.find(".outcomes_select:not(.blank):first").click()}},function(){h.find(".loading_message").text("Outcomes Retrieval failed unexpected.  Please try again.")})}h.dialog("close").dialog({autoOpen:false,modal:true,title:"Find Outcome Criterion",width:700,height:400}).dialog("open")},hideCriterionAdd:function(b){b.find(".add_right, .add_left, .add_column").removeClass("add_left add_right add_column")},
updateRubricPoints:function(b){var h=0;b.find(".criterion:not(.blank):not(.ignore_criterion_for_scoring) .criterion_points").each(function(){var a=parseFloat($(this).val(),10);isNaN(a)||(h+=a)});b.find(".rubric_total").text(h)},updateCriterionPoints:function(b,h){rubricEditing.hideEditRating();var a=$.makeArray(b.find(".rating")).reverse(),d=-1,e=parseFloat(b.find(".criterion_points").val());if(isNaN(e))e=5;b.find(".rating:first .points").text(e);$.each(a,function(i,n){var m=$(n),o=m.getTemplateData({textValues:["points"]});
if(o.points<d){o.points=d+1;m.fillTemplateData({data:o})}d=parseFloat(o.points)});if(h&&d>e)e=d;b.find(".criterion_points").val(e);b.find(".display_criterion_points").text(e);if(!b.data("criterion_points")||b.data("criterion_points")!=e){if(!b.data("criterion_points")){a=parseFloat(b.find(".rating:first .points").text());b.data("criterion_points",a)}var j=parseFloat(b.data("criterion_points")),l=e,g=b.find(".rating");$(g[0]).find(".points").text(e);for(var k=e,c=1;c<g.length-1;c++){a=parseFloat($(g[c]).find(".points").text());
var f=Math.round(a/j*l);if(isNaN(a)||a==0&&k>0)f=k-Math.round(k/(g.length-c));if(f>=k)f=k-1;k=f=Math.max(0,f);$(g[c]).find(".points").text(f)}b.data("criterion_points",e)}rubricEditing.updateRubricPoints(b.parents(".rubric"))},editRating:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditRating(true);rubricEditing.hideCriterionAdd(b.parents(".rubric"));b.find(".rating").height();var h=b.getTemplateData({textValues:["description","points"]}),a=$("#edit_rating");a.fillFormData(h);
b.find(".container").hide();b.append(a.show());a.find(":input:first").focus().select();b.addClass("editing");rubricEditing.sizeRatings(b.parents(".criterion"))}},hideEditRating:function(b){var h=$("#edit_rating");h.filter(":visible").length>0&&b&&h.find("form").submit();b=h.parents(".rating");b.removeClass("editing");h.appendTo($("body")).hide();b.find(".container").show();rubricEditing.sizeRatings(b.parents(".criterion"));rubricEditing.hideCriterionAdd(b.parents(".rubric"))},editCriterion:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditCriterion(true);
var h=b.find(".criterion_description");h.find(".description").height();var a=h.getTemplateData({textValues:["description"]}),d=$("#edit_criterion");d.fillFormData(a);h.find(".container").hide().after(d.show());d.find(":input:first").focus().select();rubricEditing.sizeRatings(b)}},hideEditCriterion:function(b){var h=$("#edit_criterion");h.filter(":visible").length>0&&b&&h.find("form").submit();b=h.parents(".criterion");h.appendTo("body").hide();b.find(".criterion_description").find(".container").show();
rubricEditing.sizeRatings(b)},originalSizeRatings:function(){var b=$(".rubric:not(.rubric_summary) .criterion:visible");if(b.length){var h=$.windowScrollTop();b.each(function(){var a=$(this),d=a.find(".ratings:visible");if(d.length){var e=d.find(".rating .container").css("height","");a=Math.max(d.height(),a.find(".criterion_description .container").height());e.css("height",a-10+"px")}});rubricEditing.htmlBody.scrollTop(h)}},rubricData:function(b){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));
b.find(".criterion_points").each(function(){var e=$(this).val();$(this).parents(".criterion").find(".display_criterion_points").text(e)});var h=b.getFormData();b.find("thead .title").text(h.title);h=b.getTemplateData({textValues:["title","description","rubric_total","rubric_association_id"]});var a={};a["rubric[title]"]=h.title;a["rubric[points_possible]"]=h.rubric_total;a["rubric_association[use_for_grading]"]=b.find(".grading_rubric_checkbox").attr("checked")?"1":"0";a["rubric_association[hide_score_total]"]=
"0";if(a["rubric_association[use_for_grading]"]=="0")a["rubric_association[hide_score_total]"]=b.find(".totalling_rubric_checkbox").attr("checked")?"1":"0";a["rubric[free_form_criterion_comments]"]=b.find(".rubric_custom_rating").attr("checked")?"1":"0";a["rubric_association[id]"]=h.rubric_association_id;var d=0;b.find(".criterion:not(.blank)").each(function(){var e=$(this);e.hasClass("learning_outcome_criterion")||e.find("span.mastery_points").text(parseFloat(e.find("input.mastery_points").val(),
10)||"0");var j=e.getTemplateData({textValues:["description","display_criterion_points","learning_outcome_id","mastery_points","long_description","criterion_id"]});j.long_description=e.find("textarea.long_description").val();j.mastery_points=e.find("span.mastery_points").text();var l="rubric[criteria]["+d+"]";a[l+"[description]"]=j.description;a[l+"[points]"]=j.display_criterion_points;a[l+"[learning_outcome_id]"]=j.learning_outcome_id;a[l+"[long_description]"]=j.long_description;a[l+"[id]"]=j.criterion_id;
if(j.learning_outcome_id)a[l+"[mastery_points]"]=j.mastery_points;var g=0;e.find(".rating").each(function(){var k=$(this).getTemplateData({textValues:["description","points","rating_id"]}),c=l+"[ratings]["+g+"]";a[c+"[description]"]=k.description;a[c+"[points]"]=k.points;a[c+"[id]"]=k.rating_id;g++});d++});a.title=a["rubric[title]"];a.points_possible=a["rubric[points_possible]"];a.rubric_id=b.attr("id").substring(7);return a=$.extend(a,$("#rubrics #rubric_parameters").getFormData())},addRubric:function(){var b=
$("#default_rubric").clone(true).attr("id","rubric_new").addClass("editing");b.find("#edit_rubric").remove();var h=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),a=h.find("#edit_rubric_form");b.append(h);a.attr("method","POST").attr("action",$("#add_rubric_url").attr("href"));h=parseFloat($("#full_assignment .points_possible").text());a.find(".rubric_grading").showIf(h||$("#full_assignment").length>0);return b},editRubric:function(b,h){var a=b.clone(true).addClass("editing");
a.find("#edit_rubric").remove();var d=a.getTemplateData({textValues:["use_for_grading","free_form_criterion_comments","hide_score_total"]});b.hide().after(a.show());var e=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),j=e.find("#edit_rubric_form");a.append(e);a.find(":text:first").focus().select();j.find(".grading_rubric_checkbox").attr("checked",d.use_for_grading=="true").triggerHandler("change");j.find(".rubric_custom_rating").attr("checked",d.free_form_criterion_comments==
"true").triggerHandler("change");j.find(".totalling_rubric_checkbox").attr("checked",d.hide_score_total=="true").triggerHandler("change");j.find(".save_button").text(a.attr("id")=="rubric_new"?"Create Rubric":"Update Rubric");j.attr("method","PUT").attr("action",h);rubricEditing.sizeRatings();return a},hideEditRubric:function(b,h){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));b.removeClass("editing");$("#edit_criterion").hide().appendTo("body");b.find(".edit_rubric").remove();
if(h){b.attr("id")!="rubric_new"?b.prev(".rubric").show():$(".add_rubric_link").slideDown();b.remove()}else b.find(".rubric_title .links").show()},updateRubric:function(b,h){b.find(".criterion:not(.blank)").remove();var a=b.find(".rating:first").clone(true).removeAttr("id");b.fillTemplateData({data:h,id:"rubric_"+h.id,hrefValues:["id","rubric_association_id"],avoid:".criterion"});b.fillFormData(h);var d=$.replaceTags(b.find(".edit_rubric_url").attr("href"),"rubric_id",h.id);b.find(".edit_rubric_link").attr("href",
d);d=$.replaceTags(b.find(".delete_rubric_url").attr("href"),"association_id",h.rubric_association_id);b.find(".delete_rubric_link").attr("href",d);b.find(".edit_rubric_link").showIf(h.permissions.update_association);b.find(".find_rubric_link").showIf(h.permissions.update_association&&!$("#rubrics").hasClass("raw_listing"));b.find(".delete_rubric_link").showIf(h.permissions.delete_association);b.find(".criterion:not(.blank) .ratings").empty();for(var e in h.criteria){d=h.criteria[e];d.display_criterion_points=
d.points;d.criterion_id=d.id;var j=b.find(".criterion.blank:first").clone(true).show().removeAttr("id");j.removeClass("blank");j.fillTemplateData({data:d});j.find(".long_description_holder").toggleClass("empty",!d.long_description);j.find(".ratings").empty();j.toggleClass("learning_outcome_criterion",!!d.learning_outcome_id);for(var l in d.ratings){var g=d.ratings[l];g.rating_id=g.id;var k=a.clone(true);k.toggleClass("edge_rating",l===0||l===d.ratings.length-1);k.fillTemplateData({data:g});j.find(".ratings").append(k)}b.find(".summary").before(j);
j.find(".criterion_points").val(d.points).blur()}b.find(".criterion:not(.blank)").find(".ratings").showIf(!h.free_form_criterion_comments).end().find(".custom_ratings").showIf(h.free_form_criterion_comments)}};rubricEditing.sizeRatings=$.debounce(10,rubricEditing.originalSizeRatings);
