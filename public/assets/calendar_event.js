var wikiSidebar;
(function(){var f=function(){$("#full_calendar_event").show();$("#edit_calendar_event_form").hide();$("#edit_calendar_event_form textarea").editorBox("destroy");if(wikiSidebar){wikiSidebar.hide();$("#sidebar_content").show()}if($("#edit_calendar_event_form").hasClass("new_event"))location.href=$(".calendar_url").attr("href")};$(document).ready(function(){wikiSidebar&&wikiSidebar.init();$(".date_field").date_field();$(".time_field").time_field();$(".delete_event_link").click(function(a){a.preventDefault();$("#full_calendar_event_holder").confirmDelete({message:"Are you sure you want to delete this event?",
url:$(this).attr("href"),success:function(){$(this).fadeOut("slow");location.href=$(".calendar_url").attr("href")}})});$(".switch_full_calendar_event_view").click(function(a){a.preventDefault();$("#calendar_event_description").editorBox("toggle")});$(".edit_calendar_event_link").click(function(a){a.preventDefault();$("#full_calendar_event").hide();a=$("#full_calendar_event").getTemplateData({textValues:["start_at_date_string","start_at_time_string","end_at_time_string","title","all_day","all_day_date"]});
if(a.description=="No Content")a.description="";a.start_date=a.start_at_date_string;a.start_date=$("#full_calendar_event .start_at_date_string").attr("title");a.start_time=a.start_at_time_string;a.end_time=a.end_at_time_string;if(a.all_day=="true"){if(a.all_day_date)a.start_date=a.all_day_date;a.start_time="";a.end_time=""}$("#edit_calendar_event_form").fillFormData(a,{object_name:"calendar_event"});$("#edit_calendar_event_form").show();$("#edit_calendar_event_form textarea").editorBox();if(wikiSidebar){wikiSidebar.attachToEditor($("#edit_calendar_event_form").find("textarea:first"));
wikiSidebar.show();$("#sidebar_content").hide()}});$("#edit_calendar_event_form .cancel_button").click(function(){f(true)});$("#edit_calendar_event_form").formSubmit({object_name:"calendar_event",processData:function(a){a["calendar_event[start_at]"]=$.datetime.process(a.start_date+" "+a.start_time);a["calendar_event[end_at]"]=$.datetime.process(a.start_date+" "+a.end_time);a["calendar_event[description]"]=$(this).find("textarea").editorBox("get_code");$("#full_calendar_event_holder").fillTemplateData({data:a,
htmlValues:["description"]});return a},beforeSubmit:function(){f();$("#full_calendar_event_holder").loadingImage()},success:function(a){var b=a.calendar_event;a=$.parseFromISO(b.start_at);var c=$.parseFromISO(b.end_at);b.start_at_date_string=a.date_formatted;b.start_at_time_string=a.time_formatted;b.end_at_time_string=c.time_formatted;b.all_day_date=Date.parse(b.all_day_date)?Date.parse(b.all_day_date).toString("MMM d, yyyy"):"";$("#full_calendar_event_holder").find(".from_string,.to_string,.end_at_time_string").showIf(b.end_at&&
b.end_at!=b.start_at);$("#full_calendar_event_holder").find(".at_string").showIf(!b.end_at||b.end_at==b.start_at);$("#full_calendar_event_holder").find(".not_all_day").showIf(!b.all_day);$("#full_calendar_event_holder").loadingImage("remove");$("#full_calendar_event_holder").fillTemplateData({data:b,htmlValues:["description"]});$("#full_calendar_event_holder .start_at_date_string").attr("title",b.start_at_date_string);$(this).find("textarea").editorBox("set_code",b.description);c=a=null;if(b.start_at){c=
b.start_at.substring(0,4);a=b.start_at.substring(5,7)}var e=$(".base_calendar_url").attr("href").split(/#/);b=e[1];e=e[0];var d={};try{d=JSON.parse(b)}catch(g){d={}}if(a&&c){d.month=a;d.year=c}$(".calendar_url").attr("href",e+"#"+encodeURIComponent(JSON.stringify(d)));if($("#full_calendar_event_holder").hasClass("editing"))location.href=$(".calendar_url").attr("href")},error:function(a){$("#full_calendar_event_holder").loadingImage("remove");$(".edit_calendar_event_link:first").click();$("#edit_calendar_event_form").formErrors(a)}});
setTimeout(function(){$("#full_calendar_event_holder").hasClass("editing")&&$(".edit_calendar_event_link:first").click()},500);$(document).fragmentChange(function(a,b){b=="#edit"&&$(".edit_calendar_event_link:first").click()});$.scrollSidebar()})})();
