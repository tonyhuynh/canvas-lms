var SWFUpload;if(SWFUpload==undefined)SWFUpload=function(a){this.initSWFUpload(a)};SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={};this.settings=a;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(b){delete SWFUpload.instances[this.movieName];throw b;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(a){if(typeof a!=="string"||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=window.location.pathname.lastIndexOf("/");path=b<=0?"/":window.location.pathname.substr(0,b)+"/";return path+a};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=this.settings[a]==undefined?b:this.settings[a]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types",
"*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",
null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching)this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime();if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=
SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};
SWFUpload.prototype.loadFlash=function(){var a,b;if(document.getElementById(this.movieName)!==null)throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(a==undefined)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;b=document.createElement("div");b.innerHTML=this.getFlashHTML();a.parentNode.replaceChild(b.firstChild,a);if(window[this.movieName]==
undefined)window[this.movieName]=this.getMovieElement()};
SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload"><param name="wmode" value="',this.settings.button_window_mode,'" /><param name="movie" value="',this.settings.flash_url,'" /><param name="quality" value="high" /><param name="menu" value="false" /><param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+
this.getFlashVars()+'" />',"</object>"].join("")};
SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",
encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),
"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),
"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined)this.movieElement=document.getElementById(this.movieName);if(this.movieElement===null)throw"Could not find Flash element";return this.movieElement};
SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if(typeof a==="object")for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")};
SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var a=null;if((a=this.getMovieElement())&&typeof a.CallFunction==="unknown"){for(var b in a)try{if(typeof a[b]==="function")a[b]=null}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieName=this.eventQueue=this.customSettings=this.settings=this.movieElement=null;return true}catch(e){return false}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\nVersion: ",SWFUpload.version,"\nMovie Name: ",this.movieName,"\nSettings:\n\tupload_url:               ",this.settings.upload_url,"\n\tflash_url:                ",this.settings.flash_url,"\n\tuse_query_string:         ",this.settings.use_query_string.toString(),"\n\trequeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n\thttp_success:             ",this.settings.http_success.join(", "),"\n\tassume_success_timeout:   ",
this.settings.assume_success_timeout,"\n\tfile_post_name:           ",this.settings.file_post_name,"\n\tpost_params:              ",this.settings.post_params.toString(),"\n\tfile_types:               ",this.settings.file_types,"\n\tfile_types_description:   ",this.settings.file_types_description,"\n\tfile_size_limit:          ",this.settings.file_size_limit,"\n\tfile_upload_limit:        ",this.settings.file_upload_limit,"\n\tfile_queue_limit:         ",this.settings.file_queue_limit,"\n\tdebug:                    ",
this.settings.debug.toString(),"\n\tprevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n\tbutton_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n\tbutton_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n\tbutton_image_url:         ",this.settings.button_image_url.toString(),"\n\tbutton_width:             ",this.settings.button_width.toString(),"\n\tbutton_height:            ",this.settings.button_height.toString(),"\n\tbutton_text:              ",
this.settings.button_text.toString(),"\n\tbutton_text_style:        ",this.settings.button_text_style.toString(),"\n\tbutton_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n\tbutton_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n\tbutton_action:            ",this.settings.button_action.toString(),"\n\tbutton_disabled:          ",this.settings.button_disabled.toString(),"\n\tcustom_settings:          ",this.settings.custom_settings.toString(),"\nEvent Handlers:\n\tswfupload_loaded_handler assigned:  ",
(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n\tfile_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n\tfile_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n\tfile_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n\tupload_start_handler assigned:      ",(typeof this.settings.upload_start_handler===
"function").toString(),"\n\tupload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n\tupload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n\tupload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n\tupload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n\tdebug_handler assigned:             ",
(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(a,b,c){return b==undefined?this.settings[a]=c:this.settings[a]=b};SWFUpload.prototype.getSetting=function(a){if(this.settings[a]!=undefined)return this.settings[a];return""};
SWFUpload.prototype.callFlash=function(a,b){b=b||[];var c=this.getMovieElement(),d,e;try{e=c.CallFunction('<invoke name="'+a+'" returntype="javascript">'+__flash__argumentsToXML(b,0)+"</invoke>");d=eval(e)}catch(f){throw"Call to "+a+" failed";}if(d!=undefined&&typeof d.post==="object")d=this.unescapeFilePostParams(d);return d};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};
SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a,b){if(b!==false)b=true;this.callFlash("CancelUpload",[a,b])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};
SWFUpload.prototype.getFile=function(a){return typeof a==="number"?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};
SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};
SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};
SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};
SWFUpload.prototype.setHTTPSuccess=function(a){if(typeof a==="string")a=a.replace(" ","").split(",");this.settings.http_success=a;this.callFlash("SetHTTPSuccess",[a])};SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a;this.callFlash("SetAssumeSuccessTimeout",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};
SWFUpload.prototype.setButtonImageURL=function(a){if(a==undefined)a="";this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a;this.settings.button_height=b;var c=this.getMovieElement();if(c!=undefined){c.style.width=a+"px";c.style.height=b+"px"}this.callFlash("SetButtonDimensions",[a,b])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};
SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b;this.settings.button_text_left_padding=a;this.callFlash("SetButtonTextPadding",[a,b])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};
SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a;this.callFlash("SetButtonCursor",[a])};
SWFUpload.prototype.queueEvent=function(a,b){if(b==undefined)b=[];else b instanceof Array||(b=[b]);var c=this;if(typeof this.settings[a]==="function"){this.eventQueue.push(function(){this.settings[a].apply(this,b)});setTimeout(function(){c.executeNextEvent()},0)}else if(this.settings[a]!==null)throw"Event handler "+a+" is unknown or is not a function";};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;typeof a==="function"&&a.apply(this)};
SWFUpload.prototype.unescapeFilePostParams=function(a){var b=/[$]([0-9a-f]{4})/i,c={},d;if(a!=undefined){for(var e in a.post)if(a.post.hasOwnProperty(e)){d=e;for(var f;(f=b.exec(d))!==null;)d=d.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));c[d]=a.post[e]}a.post=c}return a};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return false}};
SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();if(a){this.cleanUp(a);this.queueEvent("swfupload_loaded_handler")}else this.debug("Flash called back ready but the flash movie can't be found.")};
SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&typeof a.CallFunction==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{if(typeof a[b]==="function")a[b]=null}catch(c){}}}catch(d){}window.__flash__removeCallback=function(e,f){try{if(e)e[f]=null}catch(g){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};
SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,b,c])};SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};
SWFUpload.prototype.returnUploadStart=function(a){var b;if(typeof this.settings.upload_start_handler==="function"){a=this.unescapeFilePostParams(a);b=this.settings.upload_start_handler.call(this,a)}else if(this.settings.upload_start_handler!=undefined)throw"upload_start_handler must be a function";if(b===undefined)b=true;this.callFlash("ReturnUploadStart",[!!b])};SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,b,c])};
SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,b,c])};SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_success_handler",[a,b,c])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)};
SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b=[];if(typeof a==="object"&&typeof a.name==="string"&&typeof a.message==="string"){for(var c in a)a.hasOwnProperty(c)&&b.push(c+": "+a[c]);a=b.join("\n")||"";b=a.split("\n");a="EXCEPTION: "+b.join("\nEXCEPTION: ")}SWFUpload.Console.writeLine(a)}};SWFUpload.Console={};
SWFUpload.Console.writeLine=function(a){var b,c;try{b=document.getElementById("SWFUpload_Console");if(!b){c=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(c);b=document.createElement("textarea");b.id="SWFUpload_Console";b.style.fontFamily="monospace";b.setAttribute("wrap","off");b.wrap="off";b.style.overflow="auto";b.style.width="700px";b.style.height="350px";b.style.margin="5px";c.appendChild(b)}b.value+=a+"\n";b.scrollTop=b.scrollHeight-b.clientHeight}catch(d){alert("Exception: "+
d.name+" Message: "+d.message)}};
var iconFileTypes={text_plain:"Plain Text",application_msword:"Word Document","application_vnd.ms-excel":"Excel Spreadsheet","application_vnd.ms-powerpoint":"PowerPoint Presentation",application_pdf:"Adobe PDF"},swfUpload,files={folderStructure:{},folderObjects:{},processFolderObjects:function(){files.folderObjects={};files.folderStructure={};for(var a in folderObjectList)if(folderObjectList[a]){var b=folderObjectList[a].folder;files.folderObjects[b.full_name]=b;b=b.full_name.split("/");for(var c=
files.folderStructure,d=0;d<b.length;d++){c[b[d]]||(c[b[d]]={});c=c[b[d]]}}},getFolderNames:function(a){a||(a="");var b=a.split("/"),c=files.folderStructure;if(a&&a!="")for(a=0;a<b.length;a++){if(!c[b[a]])return[];c=c[b[a]]}b=[];for(var d in c)b.push(d);return b.sort()},updateFolderObject:function(a){var b=[],c=false,d;for(d in folderObjectList){var e=folderObjectList[d].folder;if(e.id==a.id){c=true;b.push({folder:a})}else b.push({folder:e})}c||b.push({folder:a});folderObjectList=b;files.processFolderObjects()},
deleteFolderObject:function(a){var b=[],c;for(c in folderObjectList){var d=folderObjectList[c].folder;d.full_name.indexOf(a)!=0&&b.push(d)}folderObjectList=b;files.processFolderObjects()},addFolder:function(a){var b=a&&a.full_name;if(!b||b=="")return false;files.updateFolderObject(a);var c=b.split("/");b=files.folderStructure;for(var d=0;d<c.length-1;d++){if(!b[c[d]])return false;b=b[c[d]]}c=c[c.length-1];b[c]||(b[c]={});d=$("#folder_content_folder").clone(true);a.lock_at=(Date.parse(a.lock_at)||
"").toString($.datetime.defaultFormat);a.unlock_at=(Date.parse(a.unlock_at)||"").toString($.datetime.defaultFormat);a.last_lock_at=(Date.parse(a.last_lock_at)||"").toString($.datetime.defaultFormat);a.last_unlock_at=(Date.parse(a.last_unlock_at)||"").toString($.datetime.defaultFormat);d.fillTemplateData({data:a,id:"folder_content_"+a.id,hrefValues:["id"]});d.find(".edit_item_link").showIf(a.permissions&&a.permissions.update);d.find(".delete_item_link").showIf(a.permissions&&a.permissions["delete"]);
d.toggleClass("folder_locked",a.permissions&&!a.permissions.read_contents);d.toggleClass("currently_locked_folder",!!a.currently_locked);a.permissions&&a.permissions.update&&d.draggable(files.draggable_options);d.droppable(files.droppable_options);var e=null;$("#folder_content .content_item").each(function(){if($(this).hasClass("file")||$(this).find(".name").text()>a.name){e=$(this);return false}});e?e.before(d):$("#folder_content").append(d);files.refreshFolder($("#folder_"+a.id));return b[c]},renameFolder:function(a,
b){if(!(!a||a=="")){var c=RegExp("^"+a),d;for(d in folderObjectList){var e=folderObjectList[d].folder;if(e.full_name.match(c)){e.full_name=e.full_name.replace(c,b);folderObjectList[d].folder=e}}files.processFolderObjects();c=files.folderObjects[a]||files.folderObjects[b];a.split("/");d=b.split("/");d=d[d.length-1];c.name=d;$("#folder_"+a.replace(/[\/ ]/g,"_")).attr("id","folder_"+c.id).find(".folder_name").text(d);$("#folder_"+c.id).find(".folder_name").text(d);files.folderLookupCache[b]=files.folderLookupCache[a];
delete files.folderLookupCache[a]}},moveFolder:function(a,b,c){a.dim();var d=a.getTemplateData({textValues:["name"]}).name,e=a.find(".folder_url").attr("href");files.folderObjects[c]&&files.folderObjects[c].id&&$.ajaxJSON(e,"PUT",{"folder[parent_folder_id]":files.folderObjects[c].id},function(){a.remove();files.renameFolder(b+"/"+d,c+"/"+d);files.deselectFolderItem(true);files.checkFolderContent();files.refreshFolder($("#folder_"+files.folderObjects[b].id));files.refreshFolder($("#folder_"+files.folderObjects[c].id));
files.selectFolder($("#folder_"+files.folderObjects[currentFolder].id))})},moveFile:function(a,b,c){a.dim();var d=a.find(".attachment_url").attr("href"),e={};files.folderLookupCache[b]||(files.folderLookupCache[b]=[]);for(var f=files.folderLookupCache[b],g=[],h=0;h<f.length;h++)if(a.attr("id")!="folder_file_"+f[h].attachment.id)g.push(f[h]);else{files.folderLookupCache[c]||(files.folderLookupCache[c]=[]);f[h].attachment.folder_name=c;files.folderLookupCache[c].push(f[h])}files.folderLookupCache[b]=
g;e["attachment[folder_id]"]=files.folderObjects[c].id;$.ajaxJSON(d,"PUT",e,function(i){i=i.attachment;a.remove();files.deselectFolderItem(true);files.checkFolderContent();files.addAttachment(i)})},getFolderName:function(a){var b=a.attr("title");if(a.parents(".folder_content").length>0)a=$("#folders .folder_name.selected");for(;a.parents(".folder").length>0;){a=a.parents(".folder");b=b?"/"+b:"";b=a.attr("title")+b}return b},refreshFolder:function(a){if(a.length!==0){var b=files.getFolderName(a);files.hideEditFile();
files.hideEditFolder();a=a.children(".folder_list");a.empty();var c=files.getFolderNames(b),d;for(d in c){var e=c[d],f=$("#folder_blank").clone(true);f.attr("title",e);f.find(".folder_name").text(e);e=files.folderObjects[b+"/"+e];f.toggleClass("folder_locked",e.permissions&&!e.permissions.read_contents);f.toggleClass("currently_locked_folder",!!e.currently_locked);f.attr("id","folder_"+e.id);f.find(".folder_name").droppable(files.droppable_options);a.append(f.show())}if(files.folderObjects[currentFolder]){b=
$("#folder_"+files.folderObjects[currentFolder].id+" .folder_name");b.hasClass("selected")||b.addClass("selected")}}},toggleSubfolder:function(a,b){files.refreshFolder(a);a.hasClass("folder_locked")||(b?a.children(".folder_name").addClass("open").end().children(".folder_list").show():a.children(".folder_name").toggleClass("open").end().children(".folder_list").toggle())},folderLookupCache:{},openFolder:function(a){var b=[];if(files.folderObjects[a]){for(var c=files.folderObjects[a];c&&c.parent_folder_id;){b.unshift(c.parent_folder_id);
var d=null,e;for(e in files.folderObjects)if(files.folderObjects[e].id==c.parent_folder_id)d=files.folderObjects[e];c=d}for(e in b){c=$("#folder_"+b[e]);c.find(".folder_name").hasClass("open")||files.toggleSubfolder(c,true)}c=$("#folder_"+files.folderObjects[a].id);c.length>0&&files.selectFolder(c)}},selectFolder:function(a){if(!(a.hasClass("selected")||a.hasClass("related"))){var b=$("#folder_content");files.deselectFolderItem(true);files.hideEditFile();files.hideEditFolder();var c=files.getFolderName(a);
if(c!=currentFolder){currentFolder=c;location.hash="#"+currentFolder;$("#edit_file_form :input.folder_name").val(currentFolder);$("#folders .folder_name.selected").removeClass("selected").removeClass("related");$("#tags .tag.selected").removeClass("selected");a.children(".folder_name").addClass("selected");if(a.hasClass("folder_locked"))b.find(".content_item").remove().end().find(".no_content_message").hide().end().find(".locked_content_message").show();else{b.find(".content_item").remove().end().find(".locked_content_message").hide().end().find(".no_content_message").hide();
a=files.getFolderNames(c);var d=[],e;for(e in a)d.push(a[e]);d.sort();for(e in d){a=files.folderObjects[c+"/"+d[e]];files.addFolder(a)}b.loadingImage({horizontal:"right"});var f={};d=$(".list_folder_url").attr("href")+escape(files.folderObjects[c].id);if(files.folderLookupCache[c]){a=files.folderLookupCache[c];for(e=0;e<a.length;e++){var g=a[e].attachment;f[g.id]=g.id;files.addAttachment(g)}}files.checkFolderContent(true);$("#folder_content").sortable("refresh");$.ajaxJSON(d,"GET",{},function(h){if(currentFolder==
c){b.loadingImage("remove");for(var i=0;i<h.length;i++){var j=h[i].attachment;files.addAttachment(j);delete f[j.id]}for(var k in f)$("#folder_file_"+k).remove();files.checkFolderContent();files.folderLookupCache[c]=h;$("#folder_content").sortable("refresh")}})}}}},addAttachment:function(a){var b=$("#folder_content");if(!(b.find("#folder_file_"+a.id).length>0)){var c=currentFolder=="unfiled"&&!a.folder_id;if(!(a.folder_id!=files.folderObjects[currentFolder].id&&!c)){c=$("#folder_content_file").clone(true);
a.name=a.display_name;a.size=a.readable_size;a.lock_at=(Date.parse(a.lock_at)||"").toString($.datetime.defaultFormat);a.unlock_at=(Date.parse(a.unlock_at)||"").toString($.datetime.defaultFormat);a.last_lock_at=(Date.parse(a.last_lock_at)||"").toString($.datetime.defaultFormat);a.last_unlock_at=(Date.parse(a.last_unlock_at)||"").toString($.datetime.defaultFormat);if(a.scribd_doc&&a.scribd_doc.attributes&&a.permissions&&a.permissions.download){a.document_id=a.scribd_doc.attributes.doc_id;a.access_key=
a.scribd_doc.attributes.access_key}c.fillTemplateData({data:a,id:"folder_file_"+a.id,hrefValues:["id"]});c.find(".preview_item_link").showIf(a.permissions&&a.permissions.download&&a.workflow_state!="errored"&&a.scribd_doc&&a.scribd_doc.attributes);c.find(".edit_item_link").showIf(a.permissions&&a.permissions.update);c.find(".reorder_item_link").showIf(a.permissions&&a.permissions.update);c.find(".delete_item_link").showIf(a.permissions&&a.permissions["delete"]);c.toggleClass("locked",a.permissions&&
!a.permissions.download);c.toggleClass("currently_locked",!!a.currently_locked);if(a.permissions&&a.permissions.update){c.addClass("draggable");c.draggable(files.draggable_options)}var d=null;b.find(".file").each(function(){var e=$(this).find(".name").text(),f=$(this).getTemplateData({textValues:["position"]}).position||9999;if(f>a.position||f==a.position&&e>a.display_name){d=$(this);return false}});d?d.before(c.show()):b.append(c.show());b.find(".no_content_message").hide().end().find(".locked_content_message").hide()}}},
selectTag:function(a){if(!a.hasClass("selected")){files.hideEditFile();files.hideEditFolder();$("#folders .folder_name.selected").removeClass("selected").removeClass("related");$("#tags .tag.selected").removeClass("selected");a.addClass("selected");a=$("#folder_content");a.empty();for(var b=0;b<20;b++){var c=$("#folder_content_file").clone(true);c.addClass("file_item").attr("id","folder_content_"+b).find(".name").text("Testing");c.draggable(files.draggable_options);a.append(c.show())}}},selectFolderItem:function(a){if(!a.hasClass("selected")){files.hideEditFile();
files.hideEditFolder();files.deselectFolderItem(true);a.addClass("selected");$("#folders .folder_name.selected").addClass("related");$("#selection_details .details").hide();var b="#";$("#selection_details .edit_link").showIf(a.find(".edit_item_link").css("display")!="none");$("#selection_details .delete_link").showIf(a.find(".delete_item_link").css("display")!="none");if(a.hasClass("folder")){$("#folder_details").show();var c=a.getTemplateData({textValues:["name","lock_at","unlock_at"]});$("#folder_details").find(".lock_at").text(c.lock_at||
"").end().find(".unlock_at").text(c.unlock_at||"");$("#folder_details").find(".current_folder_name").text(c.name).end().find(".current_folder_preview").showIf(a.hasClass("folder_locked")||a.hasClass("currently_locked_folder")).end().find(".current_folder_preview .lock_until").showIf(c.unlock_at).end().find(".current_folder_preview .lock_after").showIf(c.lock_at).end().find(".lock_item_link").showIf(!a.hasClass("folder_locked")&&!a.hasClass("currently_locked_folder")).end().find(".unlock_item_link").showIf(a.hasClass("folder_locked")||
a.hasClass("currently_locked_folder"))}else{b=$("#file_details");b.show();c=a.getTemplateData({textValues:["name","content_type","size","id","lock_at","unlock_at"]});b.find(".lock_item_link").showIf(!a.hasClass("locked")&&!a.hasClass("currently_locked")).end().find(".unlock_item_link").showIf(a.hasClass("locked")||a.hasClass("currently_locked"));c.content_type=c.content_type||"";if(c.id&&$("#image_cache_"+c.id).length>0){b.find(".current_file_preview .image_cache").hide().appendTo($("body"));var d=
$("#image_cache_"+c.id);b.find(".current_file_preview").showIf(c.content_type.indexOf("image")!=-1).find("img.image_preview").hide().end().find(".download_item_link").append(d.css("display","inline"))}else{b.find(".current_file_preview .image_cache").hide().appendTo($("body"));if(c.content_type.indexOf("image")!=-1)b.find(".current_file_preview").show().find("img.image_preview").show().attr("src",$(".preview_loading_image").attr("src")).attr("src",a.find(".preview_url").attr("href")).attr("title",
"image");else if(iconFileTypes[c.content_type.replace(/\//g,"_")]){mime_type=c.content_type.replace(/\//g,"_");b.find(".current_file_preview").show().find("img.image_preview").show().attr("src","/images/mime_types/"+mime_type+".png").attr("title",iconFileTypes[mime_type])}else b.find(".current_file_preview").hide().find("img.preview").show().attr("src","/images/mime_types/unknown.png").attr("title","");d=b.find(".current_file_preview").find("img.image_preview").clone(true);d.removeClass("image_preview").addClass("image_cache").hide().attr("id",
"image_cache_"+c.id).appendTo($("body"))}b.find(".current_file_preview img.locked").showIf(a.hasClass("locked"));d=a.find(".attachment_url").clone().text("Click here for more details.");b.find(".cant_download").find(".attachment_url").remove().end().append(d).showIf(a.hasClass("locked"));b.find(".download_item_link").showIf(!a.hasClass("locked"));b.find(".currently_locked").showIf(a.hasClass("currently_locked")).end().find(".currently_locked .lock_until").showIf(c.unlock_at).end().find(".currently_locked .lock_after").showIf(c.lock_at).end().find(".lock_at").text(c.lock_at||
"").end().find(".unlock_at").text(c.unlock_at||"");b.find(".current_file_name").text(c.name);b.find(".current_file_size").text(c.size);b=a.find(".download_url").attr("href")}$("#selection_details .download_item_link").attr("href",b)}},deselectFolderItem:function(a){var b=false;a||$("#folder_content li.content_item.selected").each(function(){if($(this).find("form").length>0){b=true;return false}});if(!b){$("#folder_content li.content_item.selected").removeClass("selected");$("#selection_details .details").hide()}},
editFolder:function(a){files.hideEditFile();files.hideEditFolder();if(a.find(".edit_item_link").css("display")!="none"){$("#folder_content .content_item.selected").removeClass("selected");a.addClass("selected");a.find(".name").hide().end().find(".links").hide();var b="Save";if(a.attr("id")=="folder_new")b="Add";var c=$("#edit_folder_form").clone(true);a.attr("id")=="folder_new"?c.attr("method","POST").attr("action",$(".new_folder_url").attr("href")):c.attr("method","PUT").attr("action",a.find(".folder_url").attr("href"));
c.find(".submit_button").text(b);b=a.getTemplateData({textValues:["name"]});b["folder[parent_folder_id]"]=files.folderObjects[currentFolder].id;c.fillFormData(b,{object_name:"folder"});a.append(c.show());c.find(":text:first").focus().select()}},hideEditFolder:function(){var a=$("#edit_folder_form").parents(".folder:first");a.find(".name").show().end().find(".links").css("display","").children("a").css("display","");$("#content").append($("#edit_folder_form").hide());a.attr("id")=="folder_new"&&a.remove()},
editFile:function(a,b){files.hideEditFile();files.hideEditFolder();if(a.find(".edit_item_link").css("display")!="none"){b||(b=false);files.deselectFolderItem(true);a.addClass("selected").find(".name").hide().end().find(".links").hide();var c="Save";if(a.attr("id")=="file_new")c="Add";var d=$("#edit_file_form").clone(true);d.addClass("edit_file_form_clone");d.find(".submit_button").text(c);b?d.find(".show_upload_link").hide().end().find(".upload").show().end().find(".file_name").hide().end().find(".file_display_option").show():
d.find(".show_upload_link").hide().end().find(".upload").hide().end().find(".file_name").show().end().find(".file_display_option").hide();c=a.getTemplateData({textValues:["name"]});c.display_name=c.name;c.folder_id=files.folderObjects[currentFolder].id;d.find(".file_upload").change();d.fillFormData(c,{object_name:"attachment"});if(a.attr("id")=="file_new"){d.attr("method","POST").attr("action",$(".new_attachment_url").attr("href"));d.attr("action",$(".json_upload_url").attr("href"))}else d.attr("method",
"PUT").attr("action",a.find(".attachment_url").attr("href"));a.append(d.show());b?d.find("input[type='file']").eq(0).focus().select():d.find("input[type='text']").eq(0).focus().select()}},hideEditFile:function(){var a=$("#edit_file_form"),b=a.parents(".file:first");b.find(".name").show().end().find(".uploading_message").hide().end().find(".links").css("display","").end().find(".file_display_option").show().end().find(".file_name").hide();$("#content").append(a.hide());a.hasClass("edit_file_form_clone")&&
a.remove();b.attr("id")=="file_new"&&b.remove()},draggable_options:{handle:".name",helper:function(){var a=$(this).clone().attr("id","file_drag");a.addClass("file_drag");a.find(".links").hide();return a},start:function(){files.selectFolderItem($(this));$(this).addClass("file_drag");$("#file_drag").addClass("selected")},stop:function(){$(this).removeClass("file_drag")},distance:5},droppable_options:{accept:".file_drag",hoverClass:"drop_target",tolerance:"pointer",drop:function(a,b){var c=files.getFolderName($(this));
if($(this).parents("#folder_content").length>0){c=currentFolder;c+="/"+$(this).find(".name").text()}var d=$(b.draggable);if(d.hasClass("file")){d=$(b.draggable);files.moveFile(d,currentFolder,c)}else if(d.hasClass("folder")){d=$(b.draggable);files.moveFolder(d,currentFolder,c)}}},lastClick:null,selectedItemClick:function(){var a=$("#folder_content .content_item.selected");!files.lastClick||a.length>1||files.lastClick[0]!=a[0]||(a.hasClass("file")?files.editFile(a):files.editFolder(a))},checkFolderContent:function(a){var b=
$("#folder_content"),c=b.find(".content_item.file").length,d=b.find(".content_item.folder").length;b.find(".no_content_message").showIf(b.find(".content_item").length===0);b.find(".locked_content_message").hide();$(".current_file_count").text(a?"...":c);$(".current_folder_count").text(a||!d?"":"and "+d+" sub-folder"+(d>1?"s":"")+" ");$(".current_folder").text(files.folderObjects[currentFolder].name);a?b.find(".no_content_message .message").text("Loading..."):b.find(".no_content_message .message").text("Nothing in this folder...")},
deleteItem:function(a){files.selectFolderItem(a);var b=currentFolder;if(a.hasClass("file")){files.hideEditFile();var c=a.find(".name").text();a.confirmDelete({url:a.find(".attachment_url").attr("href"),message:"Are you sure you want to delete the file: \n\n"+c,success:function(){var d=$(this).attr("id"),e=files.folderLookupCache[b],f=[],g;for(g in e){var h=e[g];"folder_file_"+h.attachment.id!=d&&f.push(h)}files.folderLookupCache[b]=f;$(this).fadeOut(function(){$(this).remove();files.checkFolderContent();
files.deselectFolderItem()})}})}else{files.hideEditFolder();c=a.find(".name").text();a.confirmDelete({url:a.find(".folder_url").attr("href"),message:"Are you sure you want to delete the folder:\n\n"+c,success:function(){var d=$(this).find(".name").text(),e=files.folderObjects[b+"/"+d].id;files.deleteFolderObject(b+"/"+d);$("#folder_"+e).remove();$(this).fadeOut(function(){$(this).remove();files.deselectFolderItem();files.checkFolderContent()})}})}},updateQuota:function(){if($(".quota_details").length!==
0){var a=$(".quota_url").attr("href");$.getJSON(a,function(b){$(".quota_details").fillTemplateData({data:b});b.quota_full&&$(".quota_details").addClass("quota_full")})}}};$(document).ready(function(){files.processFolderObjects()});
var fileUpload={fileDialogComplete:function(a,b){try{b>0&&this.startUpload()}catch(c){this.debug(c)}},fileQueued:function(a){fileUpload.initFile(a).find(".status").text("Queued")},fileQueueError:function(a,b,c){a=fileUpload.initFile(a);a.find(".status").text("Failed").end().find(".cancel_upload_link").hide();a.append(c)},initFile:function(a){var b=$("#file_upload_"+a.id);if(b.length===0){b=$("#file_upload_blank").clone(true).attr("id","file_upload_"+a.id);$("#file_uploads").append(b);b.find(".progress_bar").progressbar();
b.click(function(c){if($(this).find(".cancel_upload_link:visible").length===0){c.preventDefault();$(this).slideUp(function(){$(this).remove()})}});b.find(".cancel_upload_link").click(function(c){c.preventDefault();c=($(this).parents(".file_upload").attr("id")||"").substring(12);swfUpload.cancelUpload(c,true)})}b.find(".file_name").text(a.name);b.slideDown("fast");return b},uploadStart:function(a){var b=fileUpload.initFile(a);this.addFileParam(a.id,"file_extension",a.type);b.find(".status").text("Uploading")},
uploadProgress:function(a,b){try{var c=Math.ceil(b/a.size*100);$("#file_upload_"+a.id).find(".progress_bar").progressbar("value",c);c===100?$("#file_upload_"+a.id).find(".cancel_upload_link").hide().end().find(".status").text("Uploading"):$("#file_upload_"+a.id).find(".status").text("Uploading")}catch(d){this.debug(d)}},uploadSuccess:function(a,b){try{$("#file_upload_"+a.id).find(".cancel_upload_link").hide().end().find(".status").text("Done uploading");var c=$("#file_upload_"+a.id);setTimeout(function(){c.slideUp(function(){c.remove()})},
5E3);var d=eval("("+b+")").attachment;files.addAttachment(d)}catch(e){this.debug(e)}},uploadComplete:function(){try{if(this.getStats().files_queued>0)this.startUpload();else{$("#file_uploads_spinner").slideUp();var a=$("#file_upload_blank").clone(true).removeAttr("id").empty();a.text("Finished uploading all files");$("#file_uploads").prepend(a.slideDown("fast"));a.addClass("finished_message");a.click(function(){$(this).slideUp(function(){$(this).remove()})});setTimeout(function(){a.slideUp(function(){a.remove()})},
5E3);files.updateQuota()}}catch(b){this.debug(b)}},uploadError:function(a,b){try{$("#file_upload_"+a.id).find(".cancel_upload_link").hide().end().find(".status").text("Failed uploading");switch(b){case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:try{$("#file_upload_"+a.id).find(".status").text("Cancelled")}catch(c){this.debug(c)}break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:try{$("#file_upload_"+a.id).find(".status").text("Stopped Uploading")}catch(d){this.debug(d)}}}catch(e){this.debug(e)}},addImage:function(a){var b=
document.createElement("img");b.style.margin="5px";document.getElementById("thumbnails").appendChild(b);if(b.filters)try{b.filters.item("DXImageTransform.Microsoft.Alpha").opacity=0}catch(c){b.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}else b.style.opacity=0;b.onload=function(){$(b).fadeIn()};b.src=a}};
$(document).ready(function(){$("#view_options").accordion({header:".header",fillSpace:true,active:false});$("#view_options").accordion("activate",0);$(document).fragmentChange(function(b,c){var d=c.substring(1);files.folderObjects[d]&&files.openFolder(d)});$("#folder_content").sortable({handle:".move",axis:"y",containment:"parent",update:function(b,c){for(var d=$(c.item);d.next().hasClass("folder");)d.next().after(d);var e=[];$("#folder_content .file").each(function(){var h=$(this).getTemplateData({textValues:["id"]}).id;
e.push(h)});$("#folder_content").loadingImage();d={order:e.join(","),folder_id:files.folderObjects[currentFolder].id};var f=$(".reorder_attachments_url").attr("href"),g=currentFolder;$.ajaxJSON(f,"POST",d,function(h){$("#folder_content").loadingImage("remove");files.folderLookupCache[g]=h;currentFolder==g&&$("#folder_content").sortable("refresh")},function(){$("#folder_content").loadingImage("remove")})}});$("#folders").delegate(".folder_name","mousedown",function(b){b.preventDefault()}).delegate(".folder_name",
"dblclick",function(b){b.preventDefault();b.stopPropagation();files.toggleSubfolder($(this).parent())}).delegate(".folder_name","click",function(b){b.preventDefault();b.stopPropagation();files.selectFolder($(this).parent())});$("#folder_content").delegate(".attachment_url","mouseup",function(b){b.preventDefault();$.browser.msie&&b.stopPropagation()});$("#folder_content").delegate(".content_item","click",function(b){if($(b.target).hasClass("name")){b.preventDefault();var c=$(this);if(c.hasClass("selected")){files.lastClick=
c;setTimeout(files.selectedItemClick,300)}}else if($(this).hasClass("selected")||$(this).find("form").length>0)return;else if($(b.target).parents(".links").length>0)return;b.preventDefault();files.selectFolderItem($(this));if($(b.target).hasClass("name"))c.hasClass("draggable")||$(b.target).dblclick()}).delegate(".content_item.file","dblclick",function(b){b.preventDefault();files.lastClick=null;if(!$(this).hasClass("locked"))location.href=$(".download_item_link").attr("href")}).delegate(".content_item.folder",
"dblclick",function(){if(!($(this).find("form").length>0)){var b=$("#folders .selected:first").parent();if(b.length===0)b=$("#folders");files.toggleSubfolder(b,true);var c=$.trim($(this).text());files.selectFolder(b.find(".folder_list > .folder[title='"+c+"']"))}}).delegate(".content_item.folder","mousedown",function(b){if(!($(this).find("form").length>0)){b.preventDefault();b.stopPropagation()}});$(".preview_item_link").click(function(b){b.preventDefault();b=$(this).parents(".content_item").getTemplateData({textValues:["name",
"document_id","access_key"]});$("#preview_item_dialog").empty();var c=$(window).height()-50,d=Math.max(600,$(window).width()-100);$("#preview_item_dialog").dialog("close").dialog({autoOpen:false,title:"Preview File: "+b.name,width:d,height:c,modal:true,close:function(){}}).dialog("open");var e=scribd.Document.getDoc(b.document_id,b.access_key);$.each({jsapi_version:1,disable_related_docs:true,auto_size:false,height:"100%"},function(f,g){e.addParam(f,g)});e.write("preview_item_dialog");files.currentScribdDoc=
e});$(".lock_item_link").click(function(){var b="File",c="attachment",d=$("#lock_attachment_form"),e=$("#folder_content .content_item.selected"),f=e.find(".attachment_url").attr("href");if($(this).parents("#folder_details").length>0){b="Folder";c="folder";d=$("#lock_folder_form");f=e.find(".folder_url").attr("href")}d.attr("action",f);$("#lock_item_dialog form").hide();d.show();e=e.getTemplateData({textValues:["name","lock_at","unlock_at","last_lock_at","last_unlock_at"]});e.lock_at=e.last_lock_at;
e.unlock_at=e.last_unlock_at;e.locked=!e.lock_at&&!e.unlock_at?"1":"0";$("#lock_item_dialog").fillTemplateData({data:{name:e.name}});d.fillFormData(e,{object_name:c});$("#lock_item_dialog").dialog("close").dialog({autoOpen:true,modal:true,width:350,overlay:{backgroundColor:"#000",opacity:0.7},title:"Lock "+b}).dialog("open")});$("#lock_item_dialog .cancel_button").click(function(){$("#lock_item_dialog").dialog("close")});$("#lock_item_dialog .lock_checkbox").change(function(){$(this).parents("table").find(".lock_range").showIf(!$(this).attr("checked"))}).change();
$("#lock_attachment_form").formSubmit({processData:function(b){return b},beforeSubmit:function(){$(this).loadingImage()},success:function(b){$(this).loadingImage("remove");var c=b.attachment;$("#folder_file_"+c.id).remove();files.folderLookupCache[currentFolder]||(files.folderLookupCache[currentFolder]=[]);files.folderLookupCache[currentFolder].push(b);files.addAttachment(c);files.deselectFolderItem();files.selectFolderItem($("#folder_file_"+c.id));$("#lock_item_dialog").dialog("close")}});$("#lock_folder_form").formSubmit({processData:function(b){return b},
beforeSubmit:function(){$(this).loadingImage()},success:function(b){$(this).loadingImage("remove");b=b.folder;$("#folder_content_"+b.id).remove();files.addFolder(b);files.refreshFolder($("#folder_"+b.id));files.deselectFolderItem();files.selectFolderItem($("#folder_content_"+b.id));$("#lock_item_dialog").dialog("close")}});$(".unlock_item_link").click(function(b){b.preventDefault();var c="attachment",d=$("#lock_attachment_form"),e=$("#folder_content .content_item.selected");b=e.find(".attachment_url").attr("href");
if($(this).parents("#folder_details").length>0){c="folder";d=$("#lock_folder_form");b=e.find(".folder_url").attr("href")}d.attr("action",b);$("#lock_item_dialog form").hide();d.show();d={};d["["+c+"][locked]"]="";d["["+c+"][lock_at]"]="";d["["+c+"][unlock_at]"]="";e.loadingImage();$.ajaxJSON(b,"PUT",d,function(f){e.loadingImage("remove");e.remove();if(c=="attachment"){var g=f.attachment;files.folderLookupCache[currentFolder]||(files.folderLookupCache[currentFolder]=[]);files.folderLookupCache[currentFolder].push(f);
files.addAttachment(g);files.deselectFolderItem();files.selectFolderItem($("#folder_file_"+g.id))}else{f=f.folder;files.addFolder(f);files.refreshFolder($("#folder_"+f.id));files.deselectFolderItem();files.selectFolderItem($("#folder_content_"+f.id))}},function(){e.loadingImage("remove")})});$(".datetime_field").datetime_field();$("#folder_content .content_item.file.draggable").draggable(files.draggable_options);$("#folder_content .content_item.folder.draggable").draggable(files.draggable_options);
$("#edit_folder_form").formSubmit({processData:function(b){return b=$(this).getFormData({object_name:"folder"})},beforeSubmit:function(b){var c=$(this).parents(".content_item.folder");c.loadingImage();b=b.name;var d=c.find(".name").text();d||(d="__none__");d=currentFolder+"/"+d;var e=currentFolder+"/"+b;c.attr("id","folder_saving");c.data("folder_name",b);c.data("old_name",d);c.data("new_name",e);c.attr("title",b).children(".name").text(b).show();files.hideEditFolder();return c},success:function(b,
c){var d=b.folder;c.loadingImage("remove");var e=c.data("old_name"),f=d.full_name;c.remove();files.addFolder(d);files.renameFolder(e,f);files.refreshFolder($("#folders .folder_name.selected").parent());e.match(/__none__/)&&$("#folder_content_"+d.id).dblclick()}});$("#edit_folder_form").delegate(".cancel_button","click",function(b){b.preventDefault();files.hideEditFolder();files.checkFolderContent()});$("#file_browser").find(".folder .folder_name,.tag,#folder_content .content_item.folder").droppable(files.droppable_options);
$("#edit_file_form .file_display_option").click(function(b){b.preventDefault();b=$(this).parents("form");$(this).parents("form").find(".file_display_option").hide().end().find(".file_name").val(b.find(".file_display_name").text()||"").show().focus().select()});$("#edit_file_form .file_upload").change(function(){var b=$(this).parents("form"),c=b.find(".file_name");b.find(".change_file_name_link").showIf(c.val()!="");if(c.filter(":visible").length===0||$.trim(c.val())==""){var d=$(this).val()||"";d=
d.split(/[\\\/]/);d=d[d.length-1];b.find(".file_display_name").text(d);c.val(d);b.find(".change_file_name_link").showIf(c.val()!="")}});$("#edit_file_form").formSubmit({fileUpload:function(){var b=$(this).find(".upload").css("display")!="none"&&$(this).find(".file_upload").val();$(this).find(".uploading_message").find(".message").text(b?"Uploading...":"Updating...");return b},beforeSubmit:function(b){if($(this).parents(".file").attr("id")=="file_new"&&!b["attachment[uploaded_data]"]){$(this).errorBox("Please select a file to upload");
return false}$(this).find(".uploading_message").slideDown()},success:function(b){var c=b.attachment,d=$(this).parents(".file");files.hideEditFile();d.remove();files.folderLookupCache[currentFolder]||(files.folderLookupCache[currentFolder]=[]);files.folderLookupCache[currentFolder].push(b);files.addAttachment(c);files.updateQuota()},error:function(){$(this).find(".uploading_message").slideUp()}});setInterval(files.updateQuota,6E4);$("#edit_file_form").delegate(".cancel_button","click",function(b){b.preventDefault();
files.hideEditFile();files.checkFolderContent()}).delegate(".show_upload_link","click",function(b){b.preventDefault();$("#edit_file_form .upload").show();$(this).hide()});$("#edit_folder_form, #edit_file_form").delegate(":text","keydown",function(b){if(b.keyCode==27){$(this).parents("form:first").attr("id")=="edit_folder_form"?files.hideEditFolder():files.hideEditFile();files.checkFolderContent()}});$("#tags").delegate(".tag","click",function(b){b.preventDefault();files.selectTag($(this))});$(window).resize(function(){var b=
$(window).height(),c=$("#view_options").offset().top;b=Math.max(b-c,200)-10;$("#view_options,#folder_content").height(b).css("maxHeight","");$.browser.msie&&navigator.appVersion.match("MSIE 6.0")||$("#view_options").accordion("resize")}).triggerHandler("resize");setTimeout(function(){$(window).triggerHandler("resize")},1E3);var a=$("#file_uploads_url").attr("href");swfUpload=new SWFUpload({upload_url:a,flash_url:"/flash/swf_upload/Flash/swfupload.swf",file_size_limit:"50 MB",file_queue_error_handler:fileUpload.fileQueueError,
file_queued_handler:fileUpload.fileQueued,file_dialog_complete_handler:fileUpload.fileDialogComplete,upload_progress_handler:fileUpload.uploadProgress,upload_error_handler:fileUpload.uploadError,upload_start_handler:fileUpload.uploadStart,upload_success_handler:fileUpload.uploadSuccess,upload_complete_handler:fileUpload.uploadComplete,button_placeholder_id:"file_upload",button_width:180,button_height:25,button_text:'<span class="link">Add Multiple Files</span>',button_text_style:".link { font-family: Arial, sans-serif; font-size: 15px; color: #333333; text-align: left;}",
button_text_top_padding:3,button_text_left_padding:18,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,file_post_name:"attachment_uploaded_data",use_query_string:true,post_params:{authenticity_token:$("#ajax_authenticity_token").text(),_normandy_session:$("#file_uploads_session_id").text(),format:"json"},http_success:[200,201]});setInterval(function(){try{currentFolder&&files.folderObjects[currentFolder]&&files.folderObjects[currentFolder].id&&swfUpload.addPostParam("attachment[folder_id]",
files.folderObjects[currentFolder].id)}catch(b){}},500)});
$(document).delegate(".add_folder_link","click",function(a){a.preventDefault();if(currentFolder!="unfiled"){a=$("#folder_content_folder").clone(true);a.find(".edit_item_link").show();a.attr("id","folder_new");$("#folder_content").prepend(a.show());files.editFolder(a);files.checkFolderContent()}}).delegate(".add_file_link","click",function(a){a.preventDefault();if(!($("#file_new:visible").length>0)){a=$("#folder_content_file").clone(true);a.find(".edit_item_link").show();a.attr("id","file_new");var b=
$("#folder_content .folder:last");b.length===0?$("#folder_content").prepend(a.show()):b.after(a.show());files.editFile(a,true);files.checkFolderContent()}}).delegate(".delete_item_link","click",function(a){a.preventDefault();a=$(this).parents(".content_item");if(a.length===0)a=$("#folder_content .content_item.selected");files.deleteItem(a)}).delegate(".edit_item_link","click",function(a){a.preventDefault();a=$(this).parents(".content_item");if(a.length===0)a=$("#folder_content .content_item.selected");
files.selectFolderItem(a);if(a.hasClass("file")){var b=$(this).hasClass("replace_file_link");files.editFile(a,b)}else files.editFolder(a)});$(document).click(function(a){a=$(a.target);a.closest("#sidebar").length===0&&a.closest("a").length===0&&a.closest(".content_item").length===0&&files.deselectFolderItem()});
