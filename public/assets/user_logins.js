$(document).ready(function(){var c=$("#edit_pseudonym_form"),d=$("#passwordable_account_ids").text().split(",");c.formSubmit({processData:function(a){if(!$(this).hasClass("passwordable")||!a["pseudonym[password]"]&&!a["pseudonym[password_confirmation]"]){delete a["pseudonym[password]"];delete a["pseudonym[password_confirmation]"]}if((a["pseudonym[password]"]||a["pseudonym[password_confirmation]"])&&a["pseudonym[password]"]!=a["pseudonym[password_confirmation]"]){$(this).formErrors({"pseudonym[password]":"passwords do not match"});
return false}},beforeSubmit:function(){$(this).find("button").attr("disabled",true).filter(".submit_button").text("Saving...");var a=$(this).find(".account_id select")[0],b=a&&a.selectedIndex;$(this).data("account_name",null);$(this).data("account_name",a&&a.options[b]&&a.options[b].innerHTML)},success:function(a){$(this).find("button").attr("disabled",false).filter(".submit_button").text("Save");$(this).dialog("close");if($(this).data("unique_id_text"))var b=$(this).data("unique_id_text").parents(".login");
else{b=$("#login_information .login.blank").clone(true);$("#login_information .add_holder").before(b.show());a.pseudonym.account_name=$(this).data("account_name")||$(this).find(".default_account_name").text()}b.fillTemplateData({data:a.pseudonym,hrefValues:["account_id"]});$.inArray(a.pseudonym.account_id.toString(),d)!=-1&&b.find(".links").addClass("passwordable");$("#login_information .login .delete_pseudonym_link").show()},error:function(){$(this).find("button").attr("disabled",false).filter(".submit_button").text("Save Failed")}});
$("#edit_pseudonym_form .account_id_select").change(function(){$("#edit_pseudonym_form").find("tr.password").showIf($.inArray($(this).val(),d)!=-1)});$("#edit_pseudonym_form .cancel_button").click(function(){c.dialog("close")});$("#login_information").delegate(".login_details_link","click",function(a){a.preventDefault();$(this).parents("tr").find(".login_details").show();$(this).hide()}).delegate(".edit_pseudonym_link","click",function(a){a.preventDefault();var b=$("#edit_pseudonym_form");b.attr("action",
$(this).attr("rel")).attr("method","PUT");a=$(this).parents(".login").getTemplateData({textValues:["unique_id"]});a.password="";a.password_confirmation="";b.fillFormData(a,{object_name:"pseudonym"});a=$(this).parents(".links").hasClass("passwordable");b.toggleClass("passwordable",a);b.find("tr.password").showIf(a);b.find(".account_id").hide();b.dialog("close").dialog({autoOpen:false,width:"auto",close:function(){b.data("unique_id_text")&&b.data("unique_id_text").parents(".login").hasClass("blank")&&
b.data("unique_id_text").parents(".login").remove()}}).dialog("open");b.dialog("option","title","Update Login").find(".submit_button").text("Update Login");a=$(this).parents(".login").find(".unique_id");b.data("unique_id_text",a);b.find(":input:visible:first").focus().select()}).delegate(".delete_pseudonym_link","click",function(a){a.preventDefault();if($("#login_information .login:visible").length<2)alert("You can't delete the last login for a user");else{a=$(this).parents(".login").find(".unique_id").text();
$(this).parents(".login").confirmDelete({message:'Are you sure you want to delete the login, "'+a+'"?',url:$(this).attr("rel"),success:function(){$(this).fadeOut();$("#login_information .login:visible").length<2&&$("#login_information .login .delete_pseudonym_link").hide()}})}}).delegate(".add_pseudonym_link","click",function(a){a.preventDefault();$("#login_information .login.blank .edit_pseudonym_link").click();c.attr("action",$(this).attr("rel")).attr("method","POST");c.fillFormData({"pseudonym[unique_id]":""});
c.dialog("option","title","Add Login").find(".submit_button").text("Add Login");c.find(".account_id").show();c.find(".account_id_select").change();c.data("unique_id_text",null)})});
